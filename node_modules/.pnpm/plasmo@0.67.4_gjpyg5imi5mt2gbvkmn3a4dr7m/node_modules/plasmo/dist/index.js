#!/usr/bin/env node
import { createRequire } from 'module';const require = createRequire(import.meta.url);
var ua=Object.create;var fr=Object.defineProperty;var ma=Object.getOwnPropertyDescriptor;var pa=Object.getOwnPropertyNames;var la=Object.getPrototypeOf,fa=Object.prototype.hasOwnProperty;var C=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,r)=>(typeof require<"u"?require:e)[r]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+t+'" is not supported')});var d=(t,e)=>()=>(t&&(e=t(t=0)),e);var v=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Ie=(t,e)=>{for(var r in e)fr(t,r,{get:e[r],enumerable:!0})},da=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of pa(e))!fa.call(t,o)&&o!==r&&fr(t,o,{get:()=>e[o],enumerable:!(n=ma(e,o))||n.enumerable});return t};var U=(t,e,r)=>(r=t!=null?ua(la(t)):{},da(e||!t||!t.__esModule?fr(r,"default",{value:t,enumerable:!0}):r,t));var Te,xt,St=d(()=>{Te=typeof globalThis.process!="undefined"?globalThis.process.argv:[],xt=(t=Te[2])=>Te.filter(e=>!e.startsWith("--")).slice(Te.indexOf(t)+1)});var dr,ha,gn,hr=d(()=>{dr=()=>typeof globalThis.process!="undefined"?globalThis.process.env:{},ha=/\$([\w+]+)/gm,gn=(t,e=dr(),r=ha)=>t.replace(r,(n,o)=>e[o]||n)});var ga,q,ya,Q,bl,rt,yn,pe=d(()=>{St();hr();ga=new Set(Te),q=t=>ga.has(t),ya=Te.filter(t=>t.startsWith("--")&&t.includes("=")).map(t=>t.split("=")).reduce((t,[e,r])=>(t[e]=r,t),{}),Q=t=>ya[t],bl=q("--dry-run"),rt=()=>q("--verbose")||dr().VERBOSE==="true",yn=rt()});var fe,ve,de,M,te,wa,m,b=d(()=>{pe();fe=(t="",...e)=>console.log(t.padEnd(9),"|",...e),ve=(...t)=>fe("\u{1F7E2} DONE",...t),de=(...t)=>console.error("\u{1F534} ERROR".padEnd(9),"|",...t),M=(...t)=>fe("\u{1F535} INFO",...t),te=(...t)=>fe("\u{1F7E0} WARN",...t),wa=0,m=(...t)=>rt()&&fe(`\u{1F7E1} ${wa++}`,...t)});import{paramCase as Pa}from"change-case";var Pe,Pn,Ae=d(()=>{pe();Pe=()=>{let t=Q("--src-path")||process.env.PLASMO_SRC_PATH||"src",e=Q("--build-path")||process.env.PLASMO_BUILD_PATH||"build",r=Q("--tag")||process.env.PLASMO_TAG||(process.env.NODE_ENV==="production"?"prod":"dev"),n=Pa(Q("--target")||process.env.PLASMO_TARGET||"chrome-mv3"),[o,i]=n.split("-"),s=Q("--entry")||"popup",a=Q("--env");return{browser:o,manifestVersion:i,tag:r,srcPath:t,buildPath:e,target:n,entry:s,envPath:a}},Pn=`
    
    init

      --entry                     entry files (default: popup)
      --with-<name>               use an example template

    dev/build     

      --target [string]           set the target (default: chrome-mv3)
      --tag [string]              set the build tag (default: dev or prod depending on NODE_ENV)
      --src-path [path]           set the source path relative to project root (default: src)
      --build-path [path]         set the build path relative to project root (default: build)
      --entry                     entry point name (default: popup)
      --env                       relative path to top-level env file
`});var re,Et,De=d(()=>{b();yr();Ae();re=()=>{console.log("\u{1F7E3} Plasmo v0.67.4"),console.log("\u{1F534} The Browser Extension Framework")},Et=()=>{fe("\u{1F7E0} CMDS",gr.join(" | ")),fe("\u{1F7E1} OPTS",Pn)}});var xn={};Ie(xn,{default:()=>Sa});async function xa(){re(),Et()}var Sa,Sn=d(()=>{De();Sa=xa});var En={};Ie(En,{default:()=>ba});async function Ea(){M("Start the extension development...")}var ba,bn=d(()=>{b();ba=Ea});import{constants as wr}from"fs";import{access as _a,mkdir as ka,readdir as Ca,stat as Ma}from"fs/promises";async function vr(t,e){try{return await _a(t,e),!0}catch{return!1}}async function bt(t){return vr(t,wr.W_OK)}async function _t(t){return vr(t,wr.R_OK)}async function $(t){return vr(t,wr.F_OK)}async function kt(t){try{return(await Ma(t)).isFile()}catch{return!1}}async function Fa(t){let e=(await Ca(t,{withFileTypes:!0})).filter(r=>!La.has(r.name)).filter(r=>!/\.iml$/.test(r.name));if(e.length>0){m(`Found conflicting contents in ${t}`);let r=e.reduce((n,o)=>`${n}
	${o.name}${o.isDirectory()?"/":""}`,"");return m(r),!1}return!0}async function _n(t){if(!await bt(t))m("Directory does not exist, creating..."),await ka(t);else{if(m("Directory exists, checking if it is empty..."),!await Fa(t))throw new Error(`Directory ${t} is not empty.`);if(m("Checking if directory is writable..."),!await bt(t))throw new Error(`Directory ${t} is not accesible.`)}}var La,V=d(()=>{b();La=new Set([".DS_Store",".git",".gitattributes",".gitignore",".gitlab-ci.yml",".hg",".hgcheck",".hgignore",".idea",".npmignore",".travis.yml","LICENSE","Thumbs.db","docs","mkdocs.yml","npm-debug.log","yarn-debug.log","yarn-error.log",".pnpm-debug.log"])});import{existsSync as Ia}from"fs";import{basename as Da,resolve as ne}from"path";import{cwd as Oa}from"process";var je,Ct=d(()=>{Ae();je=(t=Oa())=>{let e=Pe();process.env.PLASMO_PROJECT_DIR=t;let r=Da(t);process.env.PLASMO_SRC_PATH=e.srcPath;let n=ne(t,e.srcPath);process.env.PLASMO_SRC_DIR=Ia(n)?n:t,process.env.PLASMO_BUILD_PATH=e.buildPath;let o=ne(t,e.buildPath);process.env.PLASMO_BUILD_DIR=o;let i=`${e.target}-${e.tag}`,s=ne(o,i),a=ne(t,".plasmo"),u=ne(a,"cache");return{packageName:r,projectDirectory:t,buildDirectory:o,distDirectory:s,distDirectoryName:i,sourceDirectory:process.env.PLASMO_SRC_DIR,packageFilePath:ne(t,"package.json"),gitIgnorePath:ne(t,".gitignore"),assetsDirectory:ne(t,"assets"),dotPlasmoDirectory:a,cacheDirectory:u,plasmoVersionFilePath:ne(u,"plasmo.version.json"),staticDirectory:ne(a,"static"),genAssetsDirectory:ne(a,"gen-assets"),entryManifestPath:ne(a,`${e.target}.plasmo.manifest.json`)}}});import Na from"@expo/spawn-async";import $a from"semver";async function Pr(t){let e=await Na(t,["--version"]),r=$a.valid(e.stdout.trim())||void 0;return{name:t,version:r}}async function Mt(){try{let t=process.env.npm_config_user_agent;if(t){if(t.startsWith("yarn"))return{name:"yarn"};if(t.startsWith("pnpm"))return{name:"pnpm"}}try{return await Pr("pnpm")}catch{return await Pr("yarn")}}catch{return await Pr("npm")}}var xr=d(()=>{});var z=v(Sr=>{"use strict";Sr.fromCallback=function(t){return Object.defineProperty(function(...e){if(typeof e[e.length-1]=="function")t.apply(this,e);else return new Promise((r,n)=>{t.call(this,...e,(o,i)=>o!=null?n(o):r(i))})},"name",{value:t.name})};Sr.fromPromise=function(t){return Object.defineProperty(function(...e){let r=e[e.length-1];if(typeof r!="function")return t.apply(this,e);t.apply(this,e.slice(0,-1)).then(n=>r(null,n),r)},"name",{value:t.name})}});var Cn=v((Zl,kn)=>{var xe=C("constants"),Ta=process.cwd,Lt=null,Aa=process.env.GRACEFUL_FS_PLATFORM||process.platform;process.cwd=function(){return Lt||(Lt=Ta.call(process)),Lt};try{process.cwd()}catch{}typeof process.chdir=="function"&&(Er=process.chdir,process.chdir=function(t){Lt=null,Er.call(process,t)},Object.setPrototypeOf&&Object.setPrototypeOf(process.chdir,Er));var Er;kn.exports=ja;function ja(t){xe.hasOwnProperty("O_SYMLINK")&&process.version.match(/^v0\.6\.[0-2]|^v0\.5\./)&&e(t),t.lutimes||r(t),t.chown=i(t.chown),t.fchown=i(t.fchown),t.lchown=i(t.lchown),t.chmod=n(t.chmod),t.fchmod=n(t.fchmod),t.lchmod=n(t.lchmod),t.chownSync=s(t.chownSync),t.fchownSync=s(t.fchownSync),t.lchownSync=s(t.lchownSync),t.chmodSync=o(t.chmodSync),t.fchmodSync=o(t.fchmodSync),t.lchmodSync=o(t.lchmodSync),t.stat=a(t.stat),t.fstat=a(t.fstat),t.lstat=a(t.lstat),t.statSync=u(t.statSync),t.fstatSync=u(t.fstatSync),t.lstatSync=u(t.lstatSync),t.chmod&&!t.lchmod&&(t.lchmod=function(c,p,f){f&&process.nextTick(f)},t.lchmodSync=function(){}),t.chown&&!t.lchown&&(t.lchown=function(c,p,f,l){l&&process.nextTick(l)},t.lchownSync=function(){}),Aa==="win32"&&(t.rename=typeof t.rename!="function"?t.rename:function(c){function p(f,l,g){var P=Date.now(),w=0;c(f,l,function x(j){if(j&&(j.code==="EACCES"||j.code==="EPERM")&&Date.now()-P<6e4){setTimeout(function(){t.stat(l,function(T,we){T&&T.code==="ENOENT"?c(f,l,x):g(j)})},w),w<100&&(w+=10);return}g&&g(j)})}return Object.setPrototypeOf&&Object.setPrototypeOf(p,c),p}(t.rename)),t.read=typeof t.read!="function"?t.read:function(c){function p(f,l,g,P,w,x){var j;if(x&&typeof x=="function"){var T=0;j=function(we,Ze,et){if(we&&we.code==="EAGAIN"&&T<10)return T++,c.call(t,f,l,g,P,w,j);x.apply(this,arguments)}}return c.call(t,f,l,g,P,w,j)}return Object.setPrototypeOf&&Object.setPrototypeOf(p,c),p}(t.read),t.readSync=typeof t.readSync!="function"?t.readSync:function(c){return function(p,f,l,g,P){for(var w=0;;)try{return c.call(t,p,f,l,g,P)}catch(x){if(x.code==="EAGAIN"&&w<10){w++;continue}throw x}}}(t.readSync);function e(c){c.lchmod=function(p,f,l){c.open(p,xe.O_WRONLY|xe.O_SYMLINK,f,function(g,P){if(g){l&&l(g);return}c.fchmod(P,f,function(w){c.close(P,function(x){l&&l(w||x)})})})},c.lchmodSync=function(p,f){var l=c.openSync(p,xe.O_WRONLY|xe.O_SYMLINK,f),g=!0,P;try{P=c.fchmodSync(l,f),g=!1}finally{if(g)try{c.closeSync(l)}catch{}else c.closeSync(l)}return P}}function r(c){xe.hasOwnProperty("O_SYMLINK")&&c.futimes?(c.lutimes=function(p,f,l,g){c.open(p,xe.O_SYMLINK,function(P,w){if(P){g&&g(P);return}c.futimes(w,f,l,function(x){c.close(w,function(j){g&&g(x||j)})})})},c.lutimesSync=function(p,f,l){var g=c.openSync(p,xe.O_SYMLINK),P,w=!0;try{P=c.futimesSync(g,f,l),w=!1}finally{if(w)try{c.closeSync(g)}catch{}else c.closeSync(g)}return P}):c.futimes&&(c.lutimes=function(p,f,l,g){g&&process.nextTick(g)},c.lutimesSync=function(){})}function n(c){return c&&function(p,f,l){return c.call(t,p,f,function(g){h(g)&&(g=null),l&&l.apply(this,arguments)})}}function o(c){return c&&function(p,f){try{return c.call(t,p,f)}catch(l){if(!h(l))throw l}}}function i(c){return c&&function(p,f,l,g){return c.call(t,p,f,l,function(P){h(P)&&(P=null),g&&g.apply(this,arguments)})}}function s(c){return c&&function(p,f,l){try{return c.call(t,p,f,l)}catch(g){if(!h(g))throw g}}}function a(c){return c&&function(p,f,l){typeof f=="function"&&(l=f,f=null);function g(P,w){w&&(w.uid<0&&(w.uid+=4294967296),w.gid<0&&(w.gid+=4294967296)),l&&l.apply(this,arguments)}return f?c.call(t,p,f,g):c.call(t,p,g)}}function u(c){return c&&function(p,f){var l=f?c.call(t,p,f):c.call(t,p);return l&&(l.uid<0&&(l.uid+=4294967296),l.gid<0&&(l.gid+=4294967296)),l}}function h(c){if(!c||c.code==="ENOSYS")return!0;var p=!process.getuid||process.getuid()!==0;return!!(p&&(c.code==="EINVAL"||c.code==="EPERM"))}}});var Fn=v((ef,Ln)=>{var Mn=C("stream").Stream;Ln.exports=Ra;function Ra(t){return{ReadStream:e,WriteStream:r};function e(n,o){if(!(this instanceof e))return new e(n,o);Mn.call(this);var i=this;this.path=n,this.fd=null,this.readable=!0,this.paused=!1,this.flags="r",this.mode=438,this.bufferSize=64*1024,o=o||{};for(var s=Object.keys(o),a=0,u=s.length;a<u;a++){var h=s[a];this[h]=o[h]}if(this.encoding&&this.setEncoding(this.encoding),this.start!==void 0){if(typeof this.start!="number")throw TypeError("start must be a Number");if(this.end===void 0)this.end=1/0;else if(typeof this.end!="number")throw TypeError("end must be a Number");if(this.start>this.end)throw new Error("start must be <= end");this.pos=this.start}if(this.fd!==null){process.nextTick(function(){i._read()});return}t.open(this.path,this.flags,this.mode,function(c,p){if(c){i.emit("error",c),i.readable=!1;return}i.fd=p,i.emit("open",p),i._read()})}function r(n,o){if(!(this instanceof r))return new r(n,o);Mn.call(this),this.path=n,this.fd=null,this.writable=!0,this.flags="w",this.encoding="binary",this.mode=438,this.bytesWritten=0,o=o||{};for(var i=Object.keys(o),s=0,a=i.length;s<a;s++){var u=i[s];this[u]=o[u]}if(this.start!==void 0){if(typeof this.start!="number")throw TypeError("start must be a Number");if(this.start<0)throw new Error("start must be >= zero");this.pos=this.start}this.busy=!1,this._queue=[],this.fd===null&&(this._open=t.open,this._queue.push([this._open,this.path,this.flags,this.mode,void 0]),this.flush())}}});var Dn=v((tf,In)=>{"use strict";In.exports=Wa;var qa=Object.getPrototypeOf||function(t){return t.__proto__};function Wa(t){if(t===null||typeof t!="object")return t;if(t instanceof Object)var e={__proto__:qa(t)};else var e=Object.create(null);return Object.getOwnPropertyNames(t).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}),e}});var K=v((rf,kr)=>{var D=C("fs"),Ba=Cn(),Ua=Fn(),Va=Dn(),Ft=C("util"),W,Dt;typeof Symbol=="function"&&typeof Symbol.for=="function"?(W=Symbol.for("graceful-fs.queue"),Dt=Symbol.for("graceful-fs.previous")):(W="___graceful-fs.queue",Dt="___graceful-fs.previous");function Ha(){}function $n(t,e){Object.defineProperty(t,W,{get:function(){return e}})}var Oe=Ha;Ft.debuglog?Oe=Ft.debuglog("gfs4"):/\bgfs4\b/i.test(process.env.NODE_DEBUG||"")&&(Oe=function(){var t=Ft.format.apply(Ft,arguments);t="GFS4: "+t.split(/\n/).join(`
GFS4: `),console.error(t)});D[W]||(On=global[W]||[],$n(D,On),D.close=function(t){function e(r,n){return t.call(D,r,function(o){o||Nn(),typeof n=="function"&&n.apply(this,arguments)})}return Object.defineProperty(e,Dt,{value:t}),e}(D.close),D.closeSync=function(t){function e(r){t.apply(D,arguments),Nn()}return Object.defineProperty(e,Dt,{value:t}),e}(D.closeSync),/\bgfs4\b/i.test(process.env.NODE_DEBUG||"")&&process.on("exit",function(){Oe(D[W]),C("assert").equal(D[W].length,0)}));var On;global[W]||$n(global,D[W]);kr.exports=br(Va(D));process.env.TEST_GRACEFUL_FS_GLOBAL_PATCH&&!D.__patched&&(kr.exports=br(D),D.__patched=!0);function br(t){Ba(t),t.gracefulify=br,t.createReadStream=Ze,t.createWriteStream=et;var e=t.readFile;t.readFile=r;function r(y,E,S){return typeof E=="function"&&(S=E,E=null),_(y,E,S);function _(O,F,I,N){return e(O,F,function(k){k&&(k.code==="EMFILE"||k.code==="ENFILE")?Re([_,[O,F,I],k,N||Date.now(),Date.now()]):typeof I=="function"&&I.apply(this,arguments)})}}var n=t.writeFile;t.writeFile=o;function o(y,E,S,_){return typeof S=="function"&&(_=S,S=null),O(y,E,S,_);function O(F,I,N,k,R){return n(F,I,N,function(L){L&&(L.code==="EMFILE"||L.code==="ENFILE")?Re([O,[F,I,N,k],L,R||Date.now(),Date.now()]):typeof k=="function"&&k.apply(this,arguments)})}}var i=t.appendFile;i&&(t.appendFile=s);function s(y,E,S,_){return typeof S=="function"&&(_=S,S=null),O(y,E,S,_);function O(F,I,N,k,R){return i(F,I,N,function(L){L&&(L.code==="EMFILE"||L.code==="ENFILE")?Re([O,[F,I,N,k],L,R||Date.now(),Date.now()]):typeof k=="function"&&k.apply(this,arguments)})}}var a=t.copyFile;a&&(t.copyFile=u);function u(y,E,S,_){return typeof S=="function"&&(_=S,S=0),O(y,E,S,_);function O(F,I,N,k,R){return a(F,I,N,function(L){L&&(L.code==="EMFILE"||L.code==="ENFILE")?Re([O,[F,I,N,k],L,R||Date.now(),Date.now()]):typeof k=="function"&&k.apply(this,arguments)})}}var h=t.readdir;t.readdir=p;var c=/^v[0-5]\./;function p(y,E,S){typeof E=="function"&&(S=E,E=null);var _=c.test(process.version)?function(I,N,k,R){return h(I,O(I,N,k,R))}:function(I,N,k,R){return h(I,N,O(I,N,k,R))};return _(y,E,S);function O(F,I,N,k){return function(R,L){R&&(R.code==="EMFILE"||R.code==="ENFILE")?Re([_,[F,I,N],R,k||Date.now(),Date.now()]):(L&&L.sort&&L.sort(),typeof N=="function"&&N.call(this,R,L))}}}if(process.version.substr(0,4)==="v0.8"){var f=Ua(t);x=f.ReadStream,T=f.WriteStream}var l=t.ReadStream;l&&(x.prototype=Object.create(l.prototype),x.prototype.open=j);var g=t.WriteStream;g&&(T.prototype=Object.create(g.prototype),T.prototype.open=we),Object.defineProperty(t,"ReadStream",{get:function(){return x},set:function(y){x=y},enumerable:!0,configurable:!0}),Object.defineProperty(t,"WriteStream",{get:function(){return T},set:function(y){T=y},enumerable:!0,configurable:!0});var P=x;Object.defineProperty(t,"FileReadStream",{get:function(){return P},set:function(y){P=y},enumerable:!0,configurable:!0});var w=T;Object.defineProperty(t,"FileWriteStream",{get:function(){return w},set:function(y){w=y},enumerable:!0,configurable:!0});function x(y,E){return this instanceof x?(l.apply(this,arguments),this):x.apply(Object.create(x.prototype),arguments)}function j(){var y=this;tt(y.path,y.flags,y.mode,function(E,S){E?(y.autoClose&&y.destroy(),y.emit("error",E)):(y.fd=S,y.emit("open",S),y.read())})}function T(y,E){return this instanceof T?(g.apply(this,arguments),this):T.apply(Object.create(T.prototype),arguments)}function we(){var y=this;tt(y.path,y.flags,y.mode,function(E,S){E?(y.destroy(),y.emit("error",E)):(y.fd=S,y.emit("open",S))})}function Ze(y,E){return new t.ReadStream(y,E)}function et(y,E){return new t.WriteStream(y,E)}var Pt=t.open;t.open=tt;function tt(y,E,S,_){return typeof S=="function"&&(_=S,S=null),O(y,E,S,_);function O(F,I,N,k,R){return Pt(F,I,N,function(L,yl){L&&(L.code==="EMFILE"||L.code==="ENFILE")?Re([O,[F,I,N,k],L,R||Date.now(),Date.now()]):typeof k=="function"&&k.apply(this,arguments)})}}return t}function Re(t){Oe("ENQUEUE",t[0].name,t[1]),D[W].push(t),_r()}var It;function Nn(){for(var t=Date.now(),e=0;e<D[W].length;++e)D[W][e].length>2&&(D[W][e][3]=t,D[W][e][4]=t);_r()}function _r(){if(clearTimeout(It),It=void 0,D[W].length!==0){var t=D[W].shift(),e=t[0],r=t[1],n=t[2],o=t[3],i=t[4];if(o===void 0)Oe("RETRY",e.name,r),e.apply(null,r);else if(Date.now()-o>=6e4){Oe("TIMEOUT",e.name,r);var s=r.pop();typeof s=="function"&&s.call(null,n)}else{var a=Date.now()-i,u=Math.max(i-o,1),h=Math.min(u*1.2,100);a>=h?(Oe("RETRY",e.name,r),e.apply(null,r.concat([o]))):D[W].push(t)}It===void 0&&(It=setTimeout(_r,0))}}});var Ne=v(he=>{"use strict";var Tn=z().fromCallback,H=K(),Ja=["access","appendFile","chmod","chown","close","copyFile","fchmod","fchown","fdatasync","fstat","fsync","ftruncate","futimes","lchmod","lchown","link","lstat","mkdir","mkdtemp","open","opendir","readdir","readFile","readlink","realpath","rename","rm","rmdir","stat","symlink","truncate","unlink","utimes","writeFile"].filter(t=>typeof H[t]=="function");Object.assign(he,H);Ja.forEach(t=>{he[t]=Tn(H[t])});he.exists=function(t,e){return typeof e=="function"?H.exists(t,e):new Promise(r=>H.exists(t,r))};he.read=function(t,e,r,n,o,i){return typeof i=="function"?H.read(t,e,r,n,o,i):new Promise((s,a)=>{H.read(t,e,r,n,o,(u,h,c)=>{if(u)return a(u);s({bytesRead:h,buffer:c})})})};he.write=function(t,e,...r){return typeof r[r.length-1]=="function"?H.write(t,e,...r):new Promise((n,o)=>{H.write(t,e,...r,(i,s,a)=>{if(i)return o(i);n({bytesWritten:s,buffer:a})})})};he.readv=function(t,e,...r){return typeof r[r.length-1]=="function"?H.readv(t,e,...r):new Promise((n,o)=>{H.readv(t,e,...r,(i,s,a)=>{if(i)return o(i);n({bytesRead:s,buffers:a})})})};he.writev=function(t,e,...r){return typeof r[r.length-1]=="function"?H.writev(t,e,...r):new Promise((n,o)=>{H.writev(t,e,...r,(i,s,a)=>{if(i)return o(i);n({bytesWritten:s,buffers:a})})})};typeof H.realpath.native=="function"?he.realpath.native=Tn(H.realpath.native):process.emitWarning("fs.realpath.native is not a function. Is fs being monkey-patched?","Warning","fs-extra-WARN0003")});var jn=v((of,An)=>{"use strict";var Ga=C("path");An.exports.checkPath=function(e){if(process.platform==="win32"&&/[<>:"|?*]/.test(e.replace(Ga.parse(e).root,""))){let n=new Error(`Path contains invalid characters: ${e}`);throw n.code="EINVAL",n}}});var Bn=v((sf,Cr)=>{"use strict";var Rn=Ne(),{checkPath:qn}=jn(),Wn=t=>{let e={mode:511};return typeof t=="number"?t:{...e,...t}.mode};Cr.exports.makeDir=async(t,e)=>(qn(t),Rn.mkdir(t,{mode:Wn(e),recursive:!0}));Cr.exports.makeDirSync=(t,e)=>(qn(t),Rn.mkdirSync(t,{mode:Wn(e),recursive:!0}))});var ie=v((af,Un)=>{"use strict";var za=z().fromPromise,{makeDir:Ka,makeDirSync:Mr}=Bn(),Lr=za(Ka);Un.exports={mkdirs:Lr,mkdirsSync:Mr,mkdirp:Lr,mkdirpSync:Mr,ensureDir:Lr,ensureDirSync:Mr}});var Se=v((cf,Hn)=>{"use strict";var Ya=z().fromPromise,Vn=Ne();function Qa(t){return Vn.access(t).then(()=>!0).catch(()=>!1)}Hn.exports={pathExists:Ya(Qa),pathExistsSync:Vn.existsSync}});var Fr=v((uf,Jn)=>{"use strict";var qe=K();function Xa(t,e,r,n){qe.open(t,"r+",(o,i)=>{if(o)return n(o);qe.futimes(i,e,r,s=>{qe.close(i,a=>{n&&n(s||a)})})})}function Za(t,e,r){let n=qe.openSync(t,"r+");return qe.futimesSync(n,e,r),qe.closeSync(n)}Jn.exports={utimesMillis:Xa,utimesMillisSync:Za}});var $e=v((mf,Kn)=>{"use strict";var We=Ne(),A=C("path"),ec=C("util");function tc(t,e,r){let n=r.dereference?o=>We.stat(o,{bigint:!0}):o=>We.lstat(o,{bigint:!0});return Promise.all([n(t),n(e).catch(o=>{if(o.code==="ENOENT")return null;throw o})]).then(([o,i])=>({srcStat:o,destStat:i}))}function rc(t,e,r){let n,o=r.dereference?s=>We.statSync(s,{bigint:!0}):s=>We.lstatSync(s,{bigint:!0}),i=o(t);try{n=o(e)}catch(s){if(s.code==="ENOENT")return{srcStat:i,destStat:null};throw s}return{srcStat:i,destStat:n}}function nc(t,e,r,n,o){ec.callbackify(tc)(t,e,n,(i,s)=>{if(i)return o(i);let{srcStat:a,destStat:u}=s;if(u){if(nt(a,u)){let h=A.basename(t),c=A.basename(e);return r==="move"&&h!==c&&h.toLowerCase()===c.toLowerCase()?o(null,{srcStat:a,destStat:u,isChangingCase:!0}):o(new Error("Source and destination must not be the same."))}if(a.isDirectory()&&!u.isDirectory())return o(new Error(`Cannot overwrite non-directory '${e}' with directory '${t}'.`));if(!a.isDirectory()&&u.isDirectory())return o(new Error(`Cannot overwrite directory '${e}' with non-directory '${t}'.`))}return a.isDirectory()&&Ir(t,e)?o(new Error(Ot(t,e,r))):o(null,{srcStat:a,destStat:u})})}function oc(t,e,r,n){let{srcStat:o,destStat:i}=rc(t,e,n);if(i){if(nt(o,i)){let s=A.basename(t),a=A.basename(e);if(r==="move"&&s!==a&&s.toLowerCase()===a.toLowerCase())return{srcStat:o,destStat:i,isChangingCase:!0};throw new Error("Source and destination must not be the same.")}if(o.isDirectory()&&!i.isDirectory())throw new Error(`Cannot overwrite non-directory '${e}' with directory '${t}'.`);if(!o.isDirectory()&&i.isDirectory())throw new Error(`Cannot overwrite directory '${e}' with non-directory '${t}'.`)}if(o.isDirectory()&&Ir(t,e))throw new Error(Ot(t,e,r));return{srcStat:o,destStat:i}}function Gn(t,e,r,n,o){let i=A.resolve(A.dirname(t)),s=A.resolve(A.dirname(r));if(s===i||s===A.parse(s).root)return o();We.stat(s,{bigint:!0},(a,u)=>a?a.code==="ENOENT"?o():o(a):nt(e,u)?o(new Error(Ot(t,r,n))):Gn(t,e,s,n,o))}function zn(t,e,r,n){let o=A.resolve(A.dirname(t)),i=A.resolve(A.dirname(r));if(i===o||i===A.parse(i).root)return;let s;try{s=We.statSync(i,{bigint:!0})}catch(a){if(a.code==="ENOENT")return;throw a}if(nt(e,s))throw new Error(Ot(t,r,n));return zn(t,e,i,n)}function nt(t,e){return e.ino&&e.dev&&e.ino===t.ino&&e.dev===t.dev}function Ir(t,e){let r=A.resolve(t).split(A.sep).filter(o=>o),n=A.resolve(e).split(A.sep).filter(o=>o);return r.reduce((o,i,s)=>o&&n[s]===i,!0)}function Ot(t,e,r){return`Cannot ${r} '${t}' to a subdirectory of itself, '${e}'.`}Kn.exports={checkPaths:nc,checkPathsSync:oc,checkParentPaths:Gn,checkParentPathsSync:zn,isSrcSubdir:Ir,areIdentical:nt}});var to=v((pf,eo)=>{"use strict";var Y=K(),ot=C("path"),ic=ie().mkdirs,sc=Se().pathExists,ac=Fr().utimesMillis,it=$e();function cc(t,e,r,n){typeof r=="function"&&!n?(n=r,r={}):typeof r=="function"&&(r={filter:r}),n=n||function(){},r=r||{},r.clobber="clobber"in r?!!r.clobber:!0,r.overwrite="overwrite"in r?!!r.overwrite:r.clobber,r.preserveTimestamps&&process.arch==="ia32"&&process.emitWarning(`Using the preserveTimestamps option in 32-bit node is not recommended;

	see https://github.com/jprichardson/node-fs-extra/issues/269`,"Warning","fs-extra-WARN0001"),it.checkPaths(t,e,"copy",r,(o,i)=>{if(o)return n(o);let{srcStat:s,destStat:a}=i;it.checkParentPaths(t,s,e,"copy",u=>{if(u)return n(u);Qn(t,e,r,(h,c)=>{if(h)return n(h);if(!c)return n();uc(a,t,e,r,n)})})})}function uc(t,e,r,n,o){let i=ot.dirname(r);sc(i,(s,a)=>{if(s)return o(s);if(a)return Dr(t,e,r,n,o);ic(i,u=>u?o(u):Dr(t,e,r,n,o))})}function Qn(t,e,r,n){if(!r.filter)return n(null,!0);Promise.resolve(r.filter(t,e)).then(o=>n(null,o),o=>n(o))}function Dr(t,e,r,n,o){(n.dereference?Y.stat:Y.lstat)(e,(s,a)=>s?o(s):a.isDirectory()?gc(a,t,e,r,n,o):a.isFile()||a.isCharacterDevice()||a.isBlockDevice()?mc(a,t,e,r,n,o):a.isSymbolicLink()?vc(t,e,r,n,o):a.isSocket()?o(new Error(`Cannot copy a socket file: ${e}`)):a.isFIFO()?o(new Error(`Cannot copy a FIFO pipe: ${e}`)):o(new Error(`Unknown file: ${e}`)))}function mc(t,e,r,n,o,i){return e?pc(t,r,n,o,i):Xn(t,r,n,o,i)}function pc(t,e,r,n,o){if(n.overwrite)Y.unlink(r,i=>i?o(i):Xn(t,e,r,n,o));else return n.errorOnExist?o(new Error(`'${r}' already exists`)):o()}function Xn(t,e,r,n,o){Y.copyFile(e,r,i=>i?o(i):n.preserveTimestamps?lc(t.mode,e,r,o):Nt(r,t.mode,o))}function lc(t,e,r,n){return fc(t)?dc(r,t,o=>o?n(o):Yn(t,e,r,n)):Yn(t,e,r,n)}function fc(t){return(t&128)===0}function dc(t,e,r){return Nt(t,e|128,r)}function Yn(t,e,r,n){hc(e,r,o=>o?n(o):Nt(r,t,n))}function Nt(t,e,r){return Y.chmod(t,e,r)}function hc(t,e,r){Y.stat(t,(n,o)=>n?r(n):ac(e,o.atime,o.mtime,r))}function gc(t,e,r,n,o,i){return e?Zn(r,n,o,i):yc(t.mode,r,n,o,i)}function yc(t,e,r,n,o){Y.mkdir(r,i=>{if(i)return o(i);Zn(e,r,n,s=>s?o(s):Nt(r,t,o))})}function Zn(t,e,r,n){Y.readdir(t,(o,i)=>o?n(o):Or(i,t,e,r,n))}function Or(t,e,r,n,o){let i=t.pop();return i?wc(t,i,e,r,n,o):o()}function wc(t,e,r,n,o,i){let s=ot.join(r,e),a=ot.join(n,e);Qn(s,a,o,(u,h)=>{if(u)return i(u);if(!h)return Or(t,r,n,o,i);it.checkPaths(s,a,"copy",o,(c,p)=>{if(c)return i(c);let{destStat:f}=p;Dr(f,s,a,o,l=>l?i(l):Or(t,r,n,o,i))})})}function vc(t,e,r,n,o){Y.readlink(e,(i,s)=>{if(i)return o(i);if(n.dereference&&(s=ot.resolve(process.cwd(),s)),t)Y.readlink(r,(a,u)=>a?a.code==="EINVAL"||a.code==="UNKNOWN"?Y.symlink(s,r,o):o(a):(n.dereference&&(u=ot.resolve(process.cwd(),u)),it.isSrcSubdir(s,u)?o(new Error(`Cannot copy '${s}' to a subdirectory of itself, '${u}'.`)):it.isSrcSubdir(u,s)?o(new Error(`Cannot overwrite '${u}' with '${s}'.`)):Pc(s,r,o)));else return Y.symlink(s,r,o)})}function Pc(t,e,r){Y.unlink(e,n=>n?r(n):Y.symlink(t,e,r))}eo.exports=cc});var so=v((lf,io)=>{"use strict";var J=K(),st=C("path"),xc=ie().mkdirsSync,Sc=Fr().utimesMillisSync,at=$e();function Ec(t,e,r){typeof r=="function"&&(r={filter:r}),r=r||{},r.clobber="clobber"in r?!!r.clobber:!0,r.overwrite="overwrite"in r?!!r.overwrite:r.clobber,r.preserveTimestamps&&process.arch==="ia32"&&process.emitWarning(`Using the preserveTimestamps option in 32-bit node is not recommended;

	see https://github.com/jprichardson/node-fs-extra/issues/269`,"Warning","fs-extra-WARN0002");let{srcStat:n,destStat:o}=at.checkPathsSync(t,e,"copy",r);if(at.checkParentPathsSync(t,n,e,"copy"),r.filter&&!r.filter(t,e))return;let i=st.dirname(e);return J.existsSync(i)||xc(i),ro(o,t,e,r)}function ro(t,e,r,n){let i=(n.dereference?J.statSync:J.lstatSync)(e);if(i.isDirectory())return Fc(i,t,e,r,n);if(i.isFile()||i.isCharacterDevice()||i.isBlockDevice())return bc(i,t,e,r,n);if(i.isSymbolicLink())return Oc(t,e,r,n);throw i.isSocket()?new Error(`Cannot copy a socket file: ${e}`):i.isFIFO()?new Error(`Cannot copy a FIFO pipe: ${e}`):new Error(`Unknown file: ${e}`)}function bc(t,e,r,n,o){return e?_c(t,r,n,o):no(t,r,n,o)}function _c(t,e,r,n){if(n.overwrite)return J.unlinkSync(r),no(t,e,r,n);if(n.errorOnExist)throw new Error(`'${r}' already exists`)}function no(t,e,r,n){return J.copyFileSync(e,r),n.preserveTimestamps&&kc(t.mode,e,r),Nr(r,t.mode)}function kc(t,e,r){return Cc(t)&&Mc(r,t),Lc(e,r)}function Cc(t){return(t&128)===0}function Mc(t,e){return Nr(t,e|128)}function Nr(t,e){return J.chmodSync(t,e)}function Lc(t,e){let r=J.statSync(t);return Sc(e,r.atime,r.mtime)}function Fc(t,e,r,n,o){return e?oo(r,n,o):Ic(t.mode,r,n,o)}function Ic(t,e,r,n){return J.mkdirSync(r),oo(e,r,n),Nr(r,t)}function oo(t,e,r){J.readdirSync(t).forEach(n=>Dc(n,t,e,r))}function Dc(t,e,r,n){let o=st.join(e,t),i=st.join(r,t);if(n.filter&&!n.filter(o,i))return;let{destStat:s}=at.checkPathsSync(o,i,"copy",n);return ro(s,o,i,n)}function Oc(t,e,r,n){let o=J.readlinkSync(e);if(n.dereference&&(o=st.resolve(process.cwd(),o)),t){let i;try{i=J.readlinkSync(r)}catch(s){if(s.code==="EINVAL"||s.code==="UNKNOWN")return J.symlinkSync(o,r);throw s}if(n.dereference&&(i=st.resolve(process.cwd(),i)),at.isSrcSubdir(o,i))throw new Error(`Cannot copy '${o}' to a subdirectory of itself, '${i}'.`);if(at.isSrcSubdir(i,o))throw new Error(`Cannot overwrite '${i}' with '${o}'.`);return Nc(o,r)}else return J.symlinkSync(o,r)}function Nc(t,e){return J.unlinkSync(e),J.symlinkSync(t,e)}io.exports=Ec});var $t=v((ff,ao)=>{"use strict";var $c=z().fromCallback;ao.exports={copy:$c(to()),copySync:so()}});var ct=v((df,uo)=>{"use strict";var co=K(),Tc=z().fromCallback;function Ac(t,e){co.rm(t,{recursive:!0,force:!0},e)}function jc(t){co.rmSync(t,{recursive:!0,force:!0})}uo.exports={remove:Tc(Ac),removeSync:jc}});var wo=v((hf,yo)=>{"use strict";var Rc=z().fromPromise,lo=Ne(),fo=C("path"),ho=ie(),go=ct(),mo=Rc(async function(e){let r;try{r=await lo.readdir(e)}catch{return ho.mkdirs(e)}return Promise.all(r.map(n=>go.remove(fo.join(e,n))))});function po(t){let e;try{e=lo.readdirSync(t)}catch{return ho.mkdirsSync(t)}e.forEach(r=>{r=fo.join(t,r),go.removeSync(r)})}yo.exports={emptyDirSync:po,emptydirSync:po,emptyDir:mo,emptydir:mo}});var So=v((gf,xo)=>{"use strict";var qc=z().fromCallback,vo=C("path"),Ee=K(),Po=ie();function Wc(t,e){function r(){Ee.writeFile(t,"",n=>{if(n)return e(n);e()})}Ee.stat(t,(n,o)=>{if(!n&&o.isFile())return e();let i=vo.dirname(t);Ee.stat(i,(s,a)=>{if(s)return s.code==="ENOENT"?Po.mkdirs(i,u=>{if(u)return e(u);r()}):e(s);a.isDirectory()?r():Ee.readdir(i,u=>{if(u)return e(u)})})})}function Bc(t){let e;try{e=Ee.statSync(t)}catch{}if(e&&e.isFile())return;let r=vo.dirname(t);try{Ee.statSync(r).isDirectory()||Ee.readdirSync(r)}catch(n){if(n&&n.code==="ENOENT")Po.mkdirsSync(r);else throw n}Ee.writeFileSync(t,"")}xo.exports={createFile:qc(Wc),createFileSync:Bc}});var Co=v((yf,ko)=>{"use strict";var Uc=z().fromCallback,Eo=C("path"),be=K(),bo=ie(),Vc=Se().pathExists,{areIdentical:_o}=$e();function Hc(t,e,r){function n(o,i){be.link(o,i,s=>{if(s)return r(s);r(null)})}be.lstat(e,(o,i)=>{be.lstat(t,(s,a)=>{if(s)return s.message=s.message.replace("lstat","ensureLink"),r(s);if(i&&_o(a,i))return r(null);let u=Eo.dirname(e);Vc(u,(h,c)=>{if(h)return r(h);if(c)return n(t,e);bo.mkdirs(u,p=>{if(p)return r(p);n(t,e)})})})})}function Jc(t,e){let r;try{r=be.lstatSync(e)}catch{}try{let i=be.lstatSync(t);if(r&&_o(i,r))return}catch(i){throw i.message=i.message.replace("lstat","ensureLink"),i}let n=Eo.dirname(e);return be.existsSync(n)||bo.mkdirsSync(n),be.linkSync(t,e)}ko.exports={createLink:Uc(Hc),createLinkSync:Jc}});var Lo=v((wf,Mo)=>{"use strict";var _e=C("path"),ut=K(),Gc=Se().pathExists;function zc(t,e,r){if(_e.isAbsolute(t))return ut.lstat(t,n=>n?(n.message=n.message.replace("lstat","ensureSymlink"),r(n)):r(null,{toCwd:t,toDst:t}));{let n=_e.dirname(e),o=_e.join(n,t);return Gc(o,(i,s)=>i?r(i):s?r(null,{toCwd:o,toDst:t}):ut.lstat(t,a=>a?(a.message=a.message.replace("lstat","ensureSymlink"),r(a)):r(null,{toCwd:t,toDst:_e.relative(n,t)})))}}function Kc(t,e){let r;if(_e.isAbsolute(t)){if(r=ut.existsSync(t),!r)throw new Error("absolute srcpath does not exist");return{toCwd:t,toDst:t}}else{let n=_e.dirname(e),o=_e.join(n,t);if(r=ut.existsSync(o),r)return{toCwd:o,toDst:t};if(r=ut.existsSync(t),!r)throw new Error("relative srcpath does not exist");return{toCwd:t,toDst:_e.relative(n,t)}}}Mo.exports={symlinkPaths:zc,symlinkPathsSync:Kc}});var Do=v((vf,Io)=>{"use strict";var Fo=K();function Yc(t,e,r){if(r=typeof e=="function"?e:r,e=typeof e=="function"?!1:e,e)return r(null,e);Fo.lstat(t,(n,o)=>{if(n)return r(null,"file");e=o&&o.isDirectory()?"dir":"file",r(null,e)})}function Qc(t,e){let r;if(e)return e;try{r=Fo.lstatSync(t)}catch{return"file"}return r&&r.isDirectory()?"dir":"file"}Io.exports={symlinkType:Yc,symlinkTypeSync:Qc}});var qo=v((Pf,Ro)=>{"use strict";var Xc=z().fromCallback,No=C("path"),se=Ne(),$o=ie(),Zc=$o.mkdirs,eu=$o.mkdirsSync,To=Lo(),tu=To.symlinkPaths,ru=To.symlinkPathsSync,Ao=Do(),nu=Ao.symlinkType,ou=Ao.symlinkTypeSync,iu=Se().pathExists,{areIdentical:jo}=$e();function su(t,e,r,n){n=typeof r=="function"?r:n,r=typeof r=="function"?!1:r,se.lstat(e,(o,i)=>{!o&&i.isSymbolicLink()?Promise.all([se.stat(t),se.stat(e)]).then(([s,a])=>{if(jo(s,a))return n(null);Oo(t,e,r,n)}):Oo(t,e,r,n)})}function Oo(t,e,r,n){tu(t,e,(o,i)=>{if(o)return n(o);t=i.toDst,nu(i.toCwd,r,(s,a)=>{if(s)return n(s);let u=No.dirname(e);iu(u,(h,c)=>{if(h)return n(h);if(c)return se.symlink(t,e,a,n);Zc(u,p=>{if(p)return n(p);se.symlink(t,e,a,n)})})})})}function au(t,e,r){let n;try{n=se.lstatSync(e)}catch{}if(n&&n.isSymbolicLink()){let a=se.statSync(t),u=se.statSync(e);if(jo(a,u))return}let o=ru(t,e);t=o.toDst,r=ou(o.toCwd,r);let i=No.dirname(e);return se.existsSync(i)||eu(i),se.symlinkSync(t,e,r)}Ro.exports={createSymlink:Xc(su),createSymlinkSync:au}});var zo=v((xf,Go)=>{"use strict";var{createFile:Wo,createFileSync:Bo}=So(),{createLink:Uo,createLinkSync:Vo}=Co(),{createSymlink:Ho,createSymlinkSync:Jo}=qo();Go.exports={createFile:Wo,createFileSync:Bo,ensureFile:Wo,ensureFileSync:Bo,createLink:Uo,createLinkSync:Vo,ensureLink:Uo,ensureLinkSync:Vo,createSymlink:Ho,createSymlinkSync:Jo,ensureSymlink:Ho,ensureSymlinkSync:Jo}});var Tt=v((Sf,Ko)=>{function cu(t,{EOL:e=`
`,finalEOL:r=!0,replacer:n=null,spaces:o}={}){let i=r?e:"";return JSON.stringify(t,n,o).replace(/\n/g,e)+i}function uu(t){return Buffer.isBuffer(t)&&(t=t.toString("utf8")),t.replace(/^\uFEFF/,"")}Ko.exports={stringify:cu,stripBom:uu}});var Zo=v((Ef,Xo)=>{var Be;try{Be=K()}catch{Be=C("fs")}var At=z(),{stringify:Yo,stripBom:Qo}=Tt();async function mu(t,e={}){typeof e=="string"&&(e={encoding:e});let r=e.fs||Be,n="throws"in e?e.throws:!0,o=await At.fromCallback(r.readFile)(t,e);o=Qo(o);let i;try{i=JSON.parse(o,e?e.reviver:null)}catch(s){if(n)throw s.message=`${t}: ${s.message}`,s;return null}return i}var pu=At.fromPromise(mu);function lu(t,e={}){typeof e=="string"&&(e={encoding:e});let r=e.fs||Be,n="throws"in e?e.throws:!0;try{let o=r.readFileSync(t,e);return o=Qo(o),JSON.parse(o,e.reviver)}catch(o){if(n)throw o.message=`${t}: ${o.message}`,o;return null}}async function fu(t,e,r={}){let n=r.fs||Be,o=Yo(e,r);await At.fromCallback(n.writeFile)(t,o,r)}var du=At.fromPromise(fu);function hu(t,e,r={}){let n=r.fs||Be,o=Yo(e,r);return n.writeFileSync(t,o,r)}var gu={readFile:pu,readFileSync:lu,writeFile:du,writeFileSync:hu};Xo.exports=gu});var ti=v((bf,ei)=>{"use strict";var jt=Zo();ei.exports={readJson:jt.readFile,readJsonSync:jt.readFileSync,writeJson:jt.writeFile,writeJsonSync:jt.writeFileSync}});var Rt=v((_f,oi)=>{"use strict";var yu=z().fromCallback,mt=K(),ri=C("path"),ni=ie(),wu=Se().pathExists;function vu(t,e,r,n){typeof r=="function"&&(n=r,r="utf8");let o=ri.dirname(t);wu(o,(i,s)=>{if(i)return n(i);if(s)return mt.writeFile(t,e,r,n);ni.mkdirs(o,a=>{if(a)return n(a);mt.writeFile(t,e,r,n)})})}function Pu(t,...e){let r=ri.dirname(t);if(mt.existsSync(r))return mt.writeFileSync(t,...e);ni.mkdirsSync(r),mt.writeFileSync(t,...e)}oi.exports={outputFile:yu(vu),outputFileSync:Pu}});var si=v((kf,ii)=>{"use strict";var{stringify:xu}=Tt(),{outputFile:Su}=Rt();async function Eu(t,e,r={}){let n=xu(e,r);await Su(t,n,r)}ii.exports=Eu});var ci=v((Cf,ai)=>{"use strict";var{stringify:bu}=Tt(),{outputFileSync:_u}=Rt();function ku(t,e,r){let n=bu(e,r);_u(t,n,r)}ai.exports=ku});var mi=v((Mf,ui)=>{"use strict";var Cu=z().fromPromise,G=ti();G.outputJson=Cu(si());G.outputJsonSync=ci();G.outputJSON=G.outputJson;G.outputJSONSync=G.outputJsonSync;G.writeJSON=G.writeJson;G.writeJSONSync=G.writeJsonSync;G.readJSON=G.readJson;G.readJSONSync=G.readJsonSync;ui.exports=G});var hi=v((Lf,di)=>{"use strict";var Mu=K(),Tr=C("path"),Lu=$t().copy,fi=ct().remove,Fu=ie().mkdirp,Iu=Se().pathExists,pi=$e();function Du(t,e,r,n){typeof r=="function"&&(n=r,r={}),r=r||{};let o=r.overwrite||r.clobber||!1;pi.checkPaths(t,e,"move",r,(i,s)=>{if(i)return n(i);let{srcStat:a,isChangingCase:u=!1}=s;pi.checkParentPaths(t,a,e,"move",h=>{if(h)return n(h);if(Ou(e))return li(t,e,o,u,n);Fu(Tr.dirname(e),c=>c?n(c):li(t,e,o,u,n))})})}function Ou(t){let e=Tr.dirname(t);return Tr.parse(e).root===e}function li(t,e,r,n,o){if(n)return $r(t,e,r,o);if(r)return fi(e,i=>i?o(i):$r(t,e,r,o));Iu(e,(i,s)=>i?o(i):s?o(new Error("dest already exists.")):$r(t,e,r,o))}function $r(t,e,r,n){Mu.rename(t,e,o=>o?o.code!=="EXDEV"?n(o):Nu(t,e,r,n):n())}function Nu(t,e,r,n){Lu(t,e,{overwrite:r,errorOnExist:!0},i=>i?n(i):fi(t,n))}di.exports=Du});var Pi=v((Ff,vi)=>{"use strict";var yi=K(),jr=C("path"),$u=$t().copySync,wi=ct().removeSync,Tu=ie().mkdirpSync,gi=$e();function Au(t,e,r){r=r||{};let n=r.overwrite||r.clobber||!1,{srcStat:o,isChangingCase:i=!1}=gi.checkPathsSync(t,e,"move",r);return gi.checkParentPathsSync(t,o,e,"move"),ju(e)||Tu(jr.dirname(e)),Ru(t,e,n,i)}function ju(t){let e=jr.dirname(t);return jr.parse(e).root===e}function Ru(t,e,r,n){if(n)return Ar(t,e,r);if(r)return wi(e),Ar(t,e,r);if(yi.existsSync(e))throw new Error("dest already exists.");return Ar(t,e,r)}function Ar(t,e,r){try{yi.renameSync(t,e)}catch(n){if(n.code!=="EXDEV")throw n;return qu(t,e,r)}}function qu(t,e,r){return $u(t,e,{overwrite:r,errorOnExist:!0}),wi(t)}vi.exports=Au});var Si=v((If,xi)=>{"use strict";var Wu=z().fromCallback;xi.exports={move:Wu(hi()),moveSync:Pi()}});var B=v((Df,Ei)=>{"use strict";Ei.exports={...Ne(),...$t(),...wo(),...zo(),...mi(),...ie(),...Si(),...Rt(),...Se(),...ct()}});var bi,_i=d(()=>{bi=()=>`
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
/node_modules
/.pnp
.pnp.js

# testing
/coverage

#cache
.turbo
.next
.vercel

# misc
.DS_Store
*.pem

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.pnpm-debug.log*


# local env files
.env*

out/
build/
dist/

# plasmo - https://www.plasmo.com
.plasmo

# bpp - http://bpp.browser.market/
keys.json

# typescript
.tsbuildinfo
`});import{sentenceCase as Bu}from"change-case";import{userInfo as Uu}from"os";import Vu from"package-json";var Hu,qt,Rr,qr=d(()=>{Hu=async({name:t="plasmo-extension",version:e="0.0.1",packageManager:r={}})=>{let n={name:t,displayName:Bu(t),version:e,description:"A basic Plasmo extension.",author:Uu().username,packageManager:void 0,scripts:{dev:"plasmo dev",build:"plasmo build",package:"plasmo package"},dependencies:{plasmo:"workspace:*",react:"18.2.0","react-dom":"18.2.0"},devDependencies:{"@plasmohq/prettier-plugin-sort-imports":"workspace:*","@types/chrome":"0.0.210","@types/node":"18.11.18","@types/react":"18.0.27","@types/react-dom":"18.0.10",prettier:"2.8.3",typescript:"4.9.4"},manifest:{host_permissions:["https://*/*"]}};return!r||!r.version?delete n.packageManager:n.packageManager=`${r.name}@${r.version}`,n},qt=async t=>await Hu(t),Rr=async t=>{let e={};return await Promise.all(Object.entries(t).map(async([r,n])=>{if(r==="plasmo")e[r]="0.67.4";else if(n==="workspace:*")try{let o=await Vu(r,{version:"latest"});e[r]=o.version}catch{e[r]=n}else e[r]=n})),e}});import{dirname as Ju,resolve as Ue}from"path";import{fileURLToPath as Gu}from"url";var Wt,Wr=d(()=>{Wt=()=>{let t=Ju(Gu(import.meta.url)),e=Ue(t,"..","templates"),r=Ue(e,"static"),n=Ue(C.resolve("@plasmohq/init"),".."),o=Ue(n,"templates"),i=Ue(n,"entries"),s=Ue(n,"bpp.yml");return{templatePath:e,initTemplatePath:o,initEntryPath:i,staticTemplatePath:r,bppYaml:s}}});import zu from"inquirer";var Ve,Br=d(()=>{Ve=async(t="",e="")=>{let{data:r}=await zu.prompt({name:"data",prefix:"\u{1F7E1}",message:t,default:e});return r}});import{strFromU8 as Ku,unzipSync as Yu}from"fflate";import{readFile as Qu}from"fs/promises";import{extname as Xu}from"path";async function Zu(t,e,r){if(t.content_security_policy&&(m("Convert content_security_policy"),e.manifest.content_security_policy={extension_pages:t.content_security_policy}),t.web_accessible_resources&&(m("Convert web_accessible_resources"),e.manifest.web_accessible_resources=[{matches:["https://*/*"],resources:t.web_accessible_resources}]),t.permissions){m("Convert permissions"),e.manifest.permissions=[],e.manifest.host_permissions=[];for(let n of t.permissions)n.startsWith("http")||n==="<all_urls>"?e.manifest.host_permissions.push(n):e.manifest.permissions.push(n)}t.browser_action&&(m("Convert browser_action"),e.manifest.action={default_title:t.browser_action.default_title}),t.background&&m("Convert background")}async function em(t,e,r){t.content_security_policy&&(m("Convert content_security_policy"),e.manifest.content_security_policy={...t.content_security_policy}),t.web_accessible_resources&&(m("Convert web_accessible_resources"),e.manifest.web_accessible_resources=[...t.web_accessible_resources]),t.permissions&&(m("Transfer permissions"),e.manifest.permissions=[...t.permissions]),t.host_permissions&&(m("Transfer host_permissions"),e.manifest.host_permissions=[...t.host_permissions]),t.action&&(m("Convert browser_action"),e.manifest.action={default_title:t.action.default_title}),t.background&&m("Convert background")}var ki,Ci,Mi,Li=d(()=>{ki=U(B(),1);b();qr();Ci=async t=>{let e={unzipped:{},isZip:!1,manifestData:{}},r=Xu(t);if(r===".zip"){let n=await Qu(t);e.unzipped=Yu(n),e.isZip=!0,e.manifestData=JSON.parse(Ku(e.unzipped["manifest.json"]))}else if(r===".json")e.manifestData=await(0,ki.readJson)(t);else return null;return e},Mi=async(t,e,{manifestData:r})=>{let n=await qt({name:t.packageName,packageManager:e});switch(n.version=r.version,n.displayName=r.name,n.description=r.description,r?.author&&(n.author=r.author),r.homepage_url&&(n.homepage=r.homepage_url),r.version_name&&(n.manifest.version_name=r.version_name),r.browser_specific_settings&&(n.manifest.browser_specific_settings=r.browser_specific_settings),r.default_locale&&m("Convert locale"),r.options_ui&&m("Convert options_ui"),r.chrome_url_overrides&&m("Convert chrome_url_overrides"),r.icons&&m("Convert icons"),r.content_scripts&&m("Convert content_scripts"),r.manifest_version){case 2:await Zu(r,n,t);break;case 3:await em(r,n,t);break;default:throw new Error("Unknown manifest version")}return n}});import tm from"@expo/spawn-async";import{sentenceCase as rm}from"change-case";import{existsSync as Fi}from"fs";import{lstat as nm,readFile as om,writeFile as im}from"fs/promises";import sm from"ignore";import{isAbsolute as am,join as cm,relative as um,resolve as pt}from"path";import{temporaryDirectory as mm}from"tempy";var ae,pm,Bt,Ii=d(()=>{ae=U(B(),1);pe();V();b();_i();qr();Wr();Br();Li();pm=/(?:^--with-)(?:\w+-?)+(?:[^-]$)/,Bt=class{constructor(e,r,n=!1){this.commonPath=e;this.packageManager=r;this.isExample=n}templatePath=Wt();async create(){return await this.createFrom()||await this.createWith()||await this.createBlank()}async createFrom(){let e=Q("--from");if(!e)return!1;let r=am(e)?e:pt(e),n=await nm(r);return n.isFile()?await this.createFromManifest(r):n.isDirectory()?await this.createFromLocalTemplate(r):!1}async createFromLocalTemplate(e){let r=sm().add(["node_modules",".git",".env*"]),n=cm(e,".gitignore");if(await $(n)){let s=await om(n,"utf-8");r.add(s)}await(0,ae.copy)(e,this.commonPath.projectDirectory,{filter:s=>s===e||!r.ignores(um(e,s))});let i=await(0,ae.readJson)(this.commonPath.packageFilePath);return await this.outputPackageData(i),M(`Creating new project from ${e}`),!0}async createFromManifest(e){let r=await Ci(e);if(r===null)return!1;await this.copyBlankInitFiles();let n=await Mi(this.commonPath,this.packageManager,r);return await this.outputPackageData(n,{resolveWorkspaceRefs:!0}),!0}async createWith(){let e=process.argv.find(r=>pm.test(r));return e===void 0?!1:this.createWithExample(e.substring(2))}async createWithExample(e){let r=mm();m(`Download examples to temporary directory: ${r}`);try{await tm("git",["clone","--depth","1","https://github.com/PlasmoHQ/examples.git","."],{cwd:r,ignoreStdio:!0})}catch(i){if(i.errno==="ENOENT")throw new Error("Unable to clone example repo. `git` is not in PATH.")}let n=pt(r,e);if(!Fi(n))throw new Error(`Example ${e} not found. You may file an example request at: https://docs.plasmo.com/exp`);m("Copy example to project directory"),await Promise.all([(0,ae.copy)(n,this.commonPath.projectDirectory),this.copyBppWorkflow()]);let o=await(0,ae.readJson)(this.commonPath.packageFilePath);return await this.outputPackageData(o,{resolveWorkspaceRefs:!0}),M(`Creating new project ${e.split("-").join(" ")}`),!0}async createBlank(){let e=await qt({name:this.commonPath.packageName,packageManager:this.isExample?void 0:this.packageManager});return m("Copying template files..."),await Promise.all([this.outputPackageData(e,{resolveWorkspaceRefs:!0}),this.copyBlankInitFiles()]),M("Creating new blank project"),!0}async outputPackageData(e,{resolveWorkspaceRefs:r=!1}={}){let{packageName:n,packageFilePath:o}=this.commonPath;e.name=n,e.displayName=rm(n),e.description=await Ve("Extension description:",e.description),this.isExample?(delete e.packageManager,e.contributors=[await Ve("Contributor name:",e.author)],e.author="Plasmo Corp. <foss@plasmo.com>"):(delete e.contributors,e.author=await Ve("Author name:",e.author),r&&(m("Replace workspace refs with the latest package version from npm registry"),await Promise.all([e.dependencies=await Rr(e.dependencies),e.devDependencies=await Rr(e.devDependencies)]))),await(0,ae.outputJson)(o,e,{spaces:2})}async copyBlankInitFiles(){let r=(Q("--entry")||"popup").split(new RegExp(",|\\s")).flatMap(n=>[`${n}.ts`,`${n}.tsx`]).map(n=>[pt(this.templatePath.initEntryPath,n),pt(this.commonPath.projectDirectory,n)]).filter(([n])=>Fi(n));m("Using the following entry files: ",r),await Promise.all([(0,ae.copy)(this.templatePath.initTemplatePath,this.commonPath.projectDirectory),this.copyBppWorkflow(),im(this.commonPath.gitIgnorePath,bi())]),await Promise.all(r.map(([n,o])=>(0,ae.copy)(n,o)))}async copyBppWorkflow(){if(this.isExample||q("--no-bpp"))return;m("Copying BPP workflow...");let e=pt(this.commonPath.projectDirectory,".github","workflows","submit.yml");return(0,ae.copy)(this.templatePath.bppYaml,e)}}});import{createQuestId as lm}from"mnemonic-id";var Di,Oi=d(()=>{St();b();Br();Di=async()=>{let[t]=xt("init");return t?(m("Using user-provided name:",t),t):(m("Prompting for the extension name"),await Ve("Extension name:",lm()))}});import Ut from"@expo/spawn-async";async function Ni(t,e){if(!await $(t.gitIgnorePath))return!1;try{return await fm(e)}catch(r){return te(r.message),!1}}var fm,$i=d(()=>{V();b();fm=async t=>{let{default:e}=await import("chalk"),r={cwd:t,ignoreStdio:!0};try{return m("Checking if the root is a git repository"),await Ut("git",["rev-parse","--is-inside-work-tree"],r),m(`${t} is a git repository, bailing ${e.bold("git init")}`),!1}catch(n){if(n.errno==="ENOENT")throw new Error("Unable to initialize git repo. `git` not in PATH.")}return M("Initializing git project..."),await Ut("git",["init"],r),await Ut("git",["add","--all"],r),await Ut("git",["commit","-m","Created a new Plasmo extension"],r),m("Added all files to git and created the initial commit."),!0}});import dm from"@expo/spawn-async";var Ti,Ai=d(()=>{b();Ti=async(t,e)=>{try{M("Installing dependencies..."),await dm(e.name,["install"],{cwd:t,stdio:"inherit"})}catch(r){te(r.message)}}});var ji,Ri=d(()=>{b();ji=async(t,e,r,n)=>{let{default:o}=await import("chalk");ve("Your extension is ready in: ",o.yellowBright(t),`

    To start hacking, run:

`,t===e?"":`      cd ${r.packageName}
`,`      ${n.name} ${n.name==="npm"?"run dev":"dev"}
`,`
    Visit https://docs.plasmo.com for documentation and more examples.`)}});var qi={};Ie(qi,{default:()=>vm});import{paramCase as hm}from"change-case";import{resolve as gm}from"path";import{cwd as ym}from"process";async function wm(){re();let t=q("--exp"),e=await Di(),r=ym(),n=gm(r,hm(e)||e);m("Project directory:",n);let o=je(n);if(m("Package name:",o.packageName),t&&!o.packageName.startsWith("with-"))throw new Error("Example extensions must have the `with-` prefix");await _n(n);let i=await Mt();m(`Using package manager: ${i.name} ${i?.version}`),await new Bt(o,i,t).create(),await Ti(n,i),await Ni(o,n),await ji(n,r,o,i)}var vm,Wi=d(()=>{pe();V();b();Ct();xr();De();Ii();Oi();$i();Ai();Ri();vm=wm});import{WebSocket as Pm,WebSocketServer as xm}from"ws";var Sm,Bi,Ui=d(()=>{Sm=JSON.stringify({type:"build_ready"}),Bi=async t=>{let e=new xm({port:t+1});return{triggerReload:()=>{for(let n of e.clients)n.readyState===Pm.OPEN&&n.send(Sm)}}}});var He,Vt=d(()=>{Ae();He=()=>{let t=Pe(),{target:e,tag:r}=t,[n,o]=e.split("-");return{tag:r,target:e,browser:n,manifestVersion:o}}});import{AssertionError as Em}from"assert";function Je(t){throw new Error("Statement should be unreachable")}function Ur(t,e="Value is invalid"){if(!t)throw new Em({message:e});return t}var lt=d(()=>{});function Lm(t){switch(t){case 0:return"Web";case 1:case 2:case 3:return Gi[t];default:Je(t)}}var Hr,Jt,Jr,ft,bm,_m,Vi,km,Cm,Mm,Vr,Gr,Ce,Me,X,Hi,Ji,Xd,Gi,Ht,Zd,eh,zi,Ki,th,le,ke,Fm,rh,Im,nh,oh,ih,sh,Yi=d(()=>{lt();Hr="en",Jt=!1,Jr=!1,ft=!1,bm=!1,_m=!1,Vi=!1,km=!1,Cm=!1,Mm=!1,Gr=Hr,Me=typeof self=="object"?self:typeof global=="object"?global:{};typeof Me.vscode<"u"&&typeof Me.vscode.process<"u"?X=Me.vscode.process:typeof process<"u"&&(X=process);Hi=typeof X?.versions?.electron=="string",Ji=Hi&&X?.type==="renderer",Xd=Ji&&X?.sandboxed;typeof navigator=="object"&&!Ji?(Ce=navigator.userAgent,Jt=Ce.indexOf("Windows")>=0,Jr=Ce.indexOf("Macintosh")>=0,Cm=(Ce.indexOf("Macintosh")>=0||Ce.indexOf("iPad")>=0||Ce.indexOf("iPhone")>=0)&&!!navigator.maxTouchPoints&&navigator.maxTouchPoints>0,ft=Ce.indexOf("Linux")>=0,Vi=!0,Vr=navigator.language,Gr=Vr):typeof X=="object"?(Jt=X.platform==="win32",Jr=X.platform==="darwin",ft=X.platform==="linux",bm=ft&&!!X.env.SNAP&&!!X.env.SNAP_REVISION,km=Hi,Mm=!!X.env.CI||!!X.env.BUILD_ARTIFACTSTAGINGDIRECTORY,Vr=Hr,Gr=Hr,_m=!0):console.error("Unable to resolve platform.");Gi={[1]:"Mac",[2]:"Linux",[3]:"Windows"};Ht=0;Jr?Ht=1:Jt?Ht=3:ft&&(Ht=2);Zd=Object.values(Gi),eh=Lm(Ht),zi=Jt,Ki=ft,th=Vi&&typeof Me.importScripts=="function",le=Ce,ke=Gr;(n=>{function t(){return ke}n.value=t;function e(){return ke.length===2?ke==="en":ke.length>=3?ke[0]==="e"&&ke[1]==="n"&&ke[2]==="-":!1}n.isDefaultVariant=e;function r(){return ke==="en"}n.isDefault=r})(Fm||={});rh=(()=>{if(typeof Me.postMessage=="function"&&!Me.importScripts){let t=[];Me.addEventListener("message",r=>{if(r.data&&r.data.vscodeScheduleAsyncWork)for(let n=0,o=t.length;n<o;n++){let i=t[n];if(i.id===r.data.vscodeScheduleAsyncWork){t.splice(n,1),i.callback();return}}});let e=0;return r=>{let n=++e;t.push({id:n,callback:r}),Me.postMessage({vscodeScheduleAsyncWork:n},"*")}}return t=>setTimeout(t)})(),Im=!!(le&&le.indexOf("Chrome")>=0),nh=!!(le&&le.indexOf("Firefox")>=0),oh=!!(!Im&&le&&le.indexOf("Safari")>=0),ih=!!(le&&le.indexOf("Edg/")>=0),sh=!!(le&&le.indexOf("Android")>=0)});var Qi,Xi=d(()=>{Yi();Qi=zi?"windows":Ki?"inotify":"fs-events"});async function ge(t,e){for(let r of t)if(await e(r))return r}var dt=d(()=>{});import{basename as Dm,extname as Zi,posix as Om,win32 as Nm}from"path";var Z,es,Ge=d(()=>{Z=t=>t.replaceAll(Nm.sep,Om.sep),es=t=>Zi(Dm(t,Zi(t)))});import{relative as $m,resolve as ts}from"path";var Gt,rs,ns=d(()=>{Gt=U(B(),1);b();Ge();rs=async({indexFilePath:t="",withMessaging:e=!1,withMainWorldScript:r=!1},n)=>{m("Creating BGSW entry");let o=ts(n.commonPath.staticDirectory,"background"),i=ts(o,"index.ts"),s=$m(o,t),a=[e&&'import "./messaging"',t&&`import "${Z(s).slice(0,-3)}"`,r&&'import "./main-world-scripts"'].filter(Boolean).join(`
`);await(0,Gt.ensureDir)(o),await(0,Gt.outputFile)(i,a)}});import{camelCase as os}from"change-case";import{relative as Tm,resolve as Am}from"path";var is,ss,as=d(()=>{is=U(B(),1);b();Ge();ss=async t=>{try{let e=Am(t.commonPath.staticDirectory,"background","main-world-scripts.ts"),r=t.mainWorldScriptList.map(o=>{let i=o.js.map(c=>{let p=os(c),f=`url:${Z(Tm(t.commonPath.entryManifestPath,c))}`;return{importName:p,importPath:f}}),s=i.map(c=>`import ${c.importName} from "${c.importPath}"`).join(`
`),a=i.map(c=>c.importName),u=Object.entries(o).reduce((c,[p,f])=>(p!=="js"&&(c[os(p)]=f),c),{id:a.join("-"),js:[]}),h=JSON.stringify(u).replace(/"js":\[\]/,`"js":[${a.map(c=>`${c}.split("/").pop().split("?")[0]`).join(",")}]`);return[s,h]});if(r.length===0)return!1;t.permissionSet.add("scripting");let n=`${r.map(([o])=>o).join(`
`)}
chrome.scripting.registerContentScripts([
  ${r.map(([,o])=>o).join(`,
  `)}
])
`;return await(0,is.outputFile)(e,n),!0}catch(e){return m(e.message),!1}}});import{resolve as jm}from"path";var cs,zr,Rm,us,ms,Kr=d(()=>{cs=U(B(),1),zr="messaging",Rm=`${zr}.d.ts`,us=(t,e)=>(0,cs.outputFile)(jm(t.dotPlasmoDirectory,Rm),e),ms=(t,e)=>`
import "@plasmohq/messaging"

interface MmMetadata {
	${t.join(`
	`)}
}

interface MpMetadata {
	${e.join(`
	`)}
}

declare module "@plasmohq/messaging" {
  interface MessagesMetadata extends MmMetadata {}
  interface PortsMetadata extends MpMetadata {}
}
`});import{createHash as qm}from"crypto";var zt,Yr=d(()=>{zt=t=>qm("md5").update(t).digest("hex").slice(0,18)});import{camelCase as Wm}from"change-case";import Bm from"fast-glob";import{join as Um,resolve as Vm}from"path";var fs,ps,Hm,ls,Jm,Gm,ds,hs=d(()=>{fs=U(B(),1);V();b();Ge();Kr();Yr();ps={md5Hash:""},Hm=(t,e,r)=>`// @ts-nocheck
globalThis.__plasmoInternalPortMap = new Map()

${t}

chrome.runtime.onMessage.addListener((request, sender, sendResponse) => {
  switch (request.name) {
    ${e}
    default:
      break
  }

  return true
})

chrome.runtime.onConnect.addListener(function(port) {
  globalThis.__plasmoInternalPortMap.set(port.name, port)
  port.onMessage.addListener(function(request) {
    switch (port.name) {
      ${r}
      default:
        break
    }
  })
})

`,ls=async(t,e)=>{let r=Um(t.projectPath.backgroundDirectory,e);return await bt(r)?(await Bm("**/*.ts",{cwd:r,onlyFiles:!0})).map(o=>{let s=Z(o).slice(0,-3),a=`${e}/${s}`,u=Wm(a);return{importName:u,name:s,declaration:`"${s}" : {}`,importCode:`import { default as ${u} } from "~background/${a}"`}}):[]},Jm=(t,e)=>`case "${t}":
  ${e}({
    sender,
    ...request
  }, {
    send: (p) => sendResponse(p)
  })
  break`,Gm=(t,e)=>`case "${t}":
  ${e}({
    port,
    ...request
  }, {
    send: (p) => port.postMessage(p)
  })
  break`,ds=async t=>{try{let[e,r]=await Promise.all([ls(t,"messages"),ls(t,"ports")]);if(m({messageHandlerList:e,portHandlerList:r}),e.length===0&&r.length===0)return!1;if(!("@plasmohq/messaging"in t.dependencies))return te("@plasmohq/messaging is not installed, skipping messaging API"),!1;let n=ms(e.map(({declaration:s})=>s),r.map(({declaration:s})=>s)),o=zt(Buffer.from(n));if(ps.md5Hash===o)return!0;ps.md5Hash=o;let i=Hm([...e,...r].map(s=>s.importCode).join(`
`),e.map(s=>Jm(s.name,s.importName)).join(`
`),r.map(s=>Gm(s.name,s.importName)).join(`
`));return await Promise.all([(0,fs.outputFile)(Vm(t.commonPath.staticDirectory,"background","messaging.ts"),i),us(t.commonPath,n)]),!0}catch(e){return m(e.message),!1}}});var ht,Qr=d(()=>{dt();V();ns();as();hs();ht=async t=>{let[e,r,n]=await Promise.all([ge(t.projectPath.backgroundIndexList,$),ds(t),ss(t)]),o=!!e||r||n;return o&&await rs({indexFilePath:e,withMessaging:r,withMainWorldScript:n},t),t.toggleBackground(o)}});import{basename as gs,resolve as Xr}from"path";import Kt from"sharp";async function Yt({assetsDirectory:t,genAssetsDirectory:e}){if(ze.baseIconPaths.length===0){let i=ys();ze.baseIconPaths=i.map(s=>Xr(t,s))}let r=await ge(ze.baseIconPaths,$);if(r===void 0){te("No icon found in assets directory");return}await(0,gt.ensureDir)(e);let o=await Kt(r).toBuffer();m(`${r} found, creating resized icons`),await Promise.all(Km.map(async i=>{if(ze.devProvidedIcons[i]===void 0){let u=ys(Zr(i));ze.devProvidedIcons[i]=u.map(h=>Xr(t,h))}let s=await ge(ze.devProvidedIcons[i],$),a=Xr(e,`icon${i}.plasmo.png`);return process.env.NODE_ENV==="development"?s!==void 0?gs(s).includes(".development.")?(0,gt.copy)(s,a):Kt(s).grayscale().toFile(a):Kt(Buffer.from(o)).resize({width:i,height:i}).greyscale(!gs(r).includes(".development.")).toFile(a):s!==void 0?(0,gt.copy)(s,a):Kt(Buffer.from(o)).resize({width:i,height:i}).toFile(a)}))}var gt,Zr,zm,ys,Km,ze,en=d(()=>{gt=U(B(),1);dt();V();b();Ae();Zr=(t=512,e="icon")=>[`${e}${t}`,`${e}-${t}`,`${e}-${t}x${t}`],zm=["icon",...Zr(),...Zr(1024)],ys=(t=zm)=>{let e=Pe();return t.map(r=>[`${r}.${e.tag}.${process.env.NODE_ENV}.png`,`${r}.${process.env.NODE_ENV}.png`,`${r}.${e.tag}.png`,`${r}.png`]).flat()},Km=[128,64,48,32,16],ze={baseIconPaths:[],devProvidedIcons:{}}});import{constantCase as Ym}from"change-case";import Qm from"dotenv";import{expand as Xm}from"dotenv-expand";import{readFile as Zm}from"fs/promises";import{resolve as ep}from"path";function rp(t){let e=Object.assign({},process.env);for(let{contents:r,name:n}of t)try{vs.add(n);let o=Xm({parsed:Qm.parse(r)});if(o.parsed){m(`Loaded env from ${n}`);let i=o.parsed||{};for(let s of Object.keys(i))typeof e[s]>"u"&&(e[s]=i[s],s.startsWith(ws)&&(process.env[s]=i[s]))}}catch(o){de(`Failed to load env from ${n}`,o)}return e}async function Ps(t){let e=await Promise.all(tn().map(i=>[i,ep(t,i)]).map(async([i,s])=>[i,s,await kt(s)&&await _t(s)])),r=await Promise.all(e.filter(([,,i])=>i).map(async([i,s])=>({name:i,contents:await Zm(s,"utf8")}))),n=rp(r),o=new yt(n);return{combinedEnv:n,plasmoPublicEnv:o,loadedEnvFiles:r}}var ws,tp,vs,yt,tn,rn=d(()=>{V();b();Ae();ws="PLASMO_",tp="PLASMO_PUBLIC_",vs=new Set,yt=class{data;constructor(e){this.data=Object.keys(e).filter(r=>r.startsWith(tp)).reduce((r,n)=>(r[n]=e[n],r),{})}extends(e){M("Loaded environment variables from:",[...vs]);let r=new yt({...this.data});return r.data.NODE_ENV=process.env.NODE_ENV,Object.entries(e).forEach(([n,o])=>{r.data[`${ws}${Ym(n)}`]=o}),r}};tn=()=>{let t=process.env.NODE_ENV,e=Pe();return[e.envPath,`.env.${e.browser}.local`,`.env.${e.tag}.local`,`.env.${t}.local`,t!=="test"?".env.local":"",`.env.${e.browser}`,`.env.${e.tag}`,`.env.${t}`,".env"].filter(r=>!!r)}});import{resolve as ce}from"path";var oe,xs,nn=d(()=>{rn();oe=(t,e)=>t.reduce((r,n)=>(r[n]=e,r),{}),xs=({sourceDirectory:t,packageFilePath:e,assetsDirectory:r},n,o)=>{let i=_=>[".ts",...o,".js"].flatMap(O=>[ce(t,`${_}${O}`),ce(t,`${_}.${n}${O}`)]),s=(_,O=[".ts",".js"])=>O.flatMap(F=>[ce(t,`${_}.${n}${F}`),ce(t,_,`index.${n}${F}`),ce(t,`${_}${F}`),ce(t,_,`index${F}`)]),a=s("popup",o),u=s("options",o),h=s("devtools",o),c=s("newtab",o),p=s("popup",[".html"]),f=s("options",[".html"]),l=s("devtools",[".html"]),g=s("newtab",[".html"]),P=tn().map(_=>ce(t,_)),w=s("background"),x=i("content"),j=i("sandbox"),T={[e]:2,...oe(P,1),...oe(x,7),...oe(j,17),...oe(w,5),...oe(a,13),...oe(u,15),...oe(h,11),...oe(c,9),...oe(p,14),...oe(f,16),...oe(l,12),...oe(g,10)},we=ce(t,"contents"),Ze=ce(t,"sandboxes"),et=ce(t,"tabs"),Pt=ce(t,"background"),tt=[[18,Ze],[4,et],[8,we],[6,Pt],[3,r]],y=new Set(Object.keys(T)),E=new Set([...w,...x,...j,...a,...u,...h,...c]);return{popupIndexList:a,popupHtmlList:p,optionsIndexList:u,optionsHtmlList:f,devtoolsIndexList:h,devtoolsHtmlList:l,newtabIndexList:c,newtabHtmlList:g,backgroundIndexList:w,backgroundDirectory:Pt,contentIndexList:x,contentsDirectory:we,sandboxIndexList:j,sandboxesDirectory:Ze,tabsDirectory:et,watchPathReasonMap:T,watchDirectoryEntries:tt,isEntryPath:_=>E.has(_),knownPathSet:y}}});import{subscribe as np}from"@parcel/watcher";var op,Ss,ip,Es=d(()=>{Xi();lt();pe();b();Qr();en();nn();op=["node_modules","build",".plasmo","coverage",".git"],Ss=async t=>{if(q("--impulse"))return null;let{default:e}=await import("is-path-inside"),{knownPathSet:r,watchPathReasonMap:n,watchDirectoryEntries:o}=t.projectPath;m("Watching the following files:",r);let i=s=>{if(r.has(s))return n[s];let a=o.find(([,u])=>e(s,u));return a?(r.add(s),n[s]=a[0]):0};return np(t.commonPath.projectDirectory,async(s,a)=>{if(s)throw s;await Promise.all(a.map(({path:u,type:h})=>ip(h,u,i(u),t))),await t.write()},{backend:Qi,ignore:op})},ip=async(t,e,r,n)=>{let o=t!=="delete";switch(r){case 0:return;case 1:{te("Environment file change detected, please restart the dev server."),await n.updateEnv();return}case 3:{M("Assets directory changed, update dynamic assets"),await Yt(n.commonPath);return}case 2:{M("package.json changed, updating manifest overides. You might need to restart the dev server."),await n.updatePackageData();return}case 6:case 5:{await ht(n);return}case 7:case 8:{await n.toggleContentScript(e,o),n.hasMainWorldScript&&await ht(n);return}case 17:case 18:case 4:{await n.togglePage(e,o);return}case 13:{n.togglePopup(o);return}case 15:{n.toggleOptions(o);return}case 11:{n.toggleDevtools(o);return}case 9:{n.toggleNewtab(o);return}case 14:{await n.scaffolder.createPageHtml("popup",o&&e);return}case 16:{await n.scaffolder.createPageHtml("options",o&&e);return}case 12:{await n.scaffolder.createPageHtml("devtools",o&&e);return}case 10:{await n.scaffolder.createPageHtml("newtab",o&&e);return}default:Je(r)}}});import sp from"@parcel/fs";import Qt from"@parcel/package-manager";import{dirname as ap,join as cp,resolve as up}from"path";import{Parcel as mp}from"@plasmohq/parcel-core";var Le,pp,Xt,on=d(()=>{Le=U(B(),1);pe();xr();pp={npm:Qt.Npm,yarn:Qt.Yarn,pnpm:Qt.Pnpm},Xt=async({commonPath:t,bundleConfig:e,publicEnv:r},{defaultTargetOptions:n={},...o})=>{let i=o.mode==="production";i?await(0,Le.emptyDir)(t.distDirectory):await(0,Le.ensureDir)(t.distDirectory),process.env.__PLASMO_FRAMEWORK_INTERNAL_SOURCE_MAPS=i?q("--inline-source-maps")?"inline":q("--source-maps")?"external":"none":q("--no-source-maps")?"none":"inline";let s=await Mt(),a=new sp.NodeFS,u=pp[s.name],h=new Qt.NodePackageManager(a,t.projectDirectory,new u),c=C.resolve("@plasmohq/parcel-config"),p=cp(ap(c),"run.json"),f=await(0,Le.readJson)(c);q("--bundle-buddy")&&(f.reporters=["...","@parcel/reporter-bundle-buddy"]),await(0,Le.writeJson)(p,f);let l={browsers:e.manifestVersion==="mv2"&&e.browser!=="firefox"?["IE 11"]:["last 1 Chrome version"]};return new mp({inputFS:a,packageManager:h,entries:t.entryManifestPath,cacheDir:up(t.cacheDirectory,"parcel"),config:p,shouldAutoInstall:!0,env:r.extends(e).data,defaultTargetOptions:{...n,engines:l,sourceMaps:process.env.__PLASMO_FRAMEWORK_INTERNAL_SOURCE_MAPS!=="none",distDir:t.distDirectory},...o})}});import{resolve as lp}from"path";async function _s({commonPath:t,publicEnv:e}){let r=Object.keys(e.data);r.length!==0&&await(0,bs.outputFile)(lp(t.dotPlasmoDirectory,fp),dp(r))}var bs,sn,fp,dp,an=d(()=>{bs=U(B(),1),sn="process.env",fp=`${sn}.d.ts`,dp=t=>`
declare namespace NodeJS {
  interface ProcessEnv {
${t.map(e=>`		${e}?: string`).join(`
`)}
  }
}
`});import hp from"typescript";var ue,wt,ks=d(()=>{({SyntaxKind:ue}=hp),wt=t=>{switch(t.kind){case ue.StringLiteral:return t.text;case ue.TrueKeyword:return!0;case ue.FalseKeyword:return!1;case ue.NullKeyword:return null;case ue.NumericLiteral:return parseFloat(t.text);case ue.ArrayLiteralExpression:return t.elements.filter(e=>e.kind!==ue.SpreadElement).map(wt);case ue.ObjectLiteralExpression:return t.properties.filter(e=>e.kind===ue.PropertyAssignment&&(e.name.kind===ue.Identifier||e.name.kind===ue.StringLiteral)).map(e=>[e.name.escapedText||e.name.text,wt(e.initializer)]).reduce((e,[r,n])=>({...e,[r]:n}),{});default:return}}});import{readFile as gp}from"fs/promises";import yp from"typescript";var wp,vp,Pp,xp,Sp,Cs,Ms=d(()=>{b();ks();({ScriptTarget:wp,SyntaxKind:vp,createSourceFile:Pp,isObjectLiteralExpression:xp,isVariableStatement:Sp}=yp),Cs=async t=>{try{let e=await gp(t,"utf8"),n=Pp(t,e,wp.Latest,!0).statements.filter(Sp).reduce((s,a)=>(a.declarationList.forEachChild(u=>{s[u.name.getText()]=u.initializer}),s),{}),o=n.config;if(!o||!xp(o))return null;let i=o.properties.reduce((s,a)=>{if(a.getChildCount()<3)return s;let[u,h,c]=a.getChildren(),p=u.getText();try{c.kind===vp.Identifier?s[p]=wt(n[c.getText()]):s[p]=wt(c)}catch(f){de(f)}return s},{});return m("Parsed config:",i),{config:i}}catch(e){return m(e),null}}});import{readFile as Ep}from"fs/promises";import bp from"json5";import{resolve as Fs}from"path";var Zt,Ls,_p,kp,Is,Ds=d(()=>{Zt=U(B(),1);Kr();an();Ls=".plasmo/index.d.ts",_p=[sn,zr].map(t=>`import "./${t}"`).join(`
`),kp=async(t,e)=>{let r=Fs(t.projectDirectory,"tsconfig.json"),n=await Ep(r,"utf8"),o=bp.parse(n),i=new Set(o.include);i.has(e)||(o.include=[e,...i],await(0,Zt.outputJson)(r,o,{spaces:2}))},Is=async t=>{let e=Fs(t.projectDirectory,Ls);await Promise.all([(0,Zt.outputFile)(e,_p),kp(t,Ls)])}});import{lstat as Cp}from"fs/promises";import{resolve as Mp}from"path";async function tr({dotPlasmoDirectory:t,cacheDirectory:e}){await(0,er.emptyDir)(t),await(0,er.ensureDir)(e)}async function Os(t){let e=Mp(t.cacheDirectory,"parcel","data.mdb");if(!await $(e))return;let o=(await Cp(e,{bigint:!0})).size/1024n**2n,i=Number(o)/1024;i>1.47&&(m(`Busting large build cache, size: ${i.toFixed(2)}GB`),await tr(t))}var er,cn=d(()=>{er=U(B(),1);V();b()});import Ns from"semver";var rr,$s,Ts=d(()=>{rr=U(B(),1);V();b();cn();$s=async t=>{let{plasmoVersionFilePath:e}=t;if(!await $(e))m("Plasmo version file not found, busting cache..."),await tr(t);else{let r=await(0,rr.readJson)(e),n=Ns.coerce(r.version),o=Ns.coerce("0.67.4");(!n||n.major<o.major||n.major===o.major&&n.minor<o.minor)&&(m("Plasmo version outdated, busting cache..."),await tr(t))}await(0,rr.writeJson)(e,{version:"0.67.4"})}});var Lp,nr,As=d(()=>{b();Lp=t=>M({target:t}),nr=(t,e=Lp)=>{if(Array.isArray(t))return t.map(r=>nr(r,e)).filter(r=>r!==void 0);if(typeof t=="object"){let r={};for(let n in t)t.hasOwnProperty(n)&&(r[n]=nr(t[n],e),r[n]===void 0&&delete r[n]);return Object.keys(r).length===0?void 0:r}else return e(t)}});import{resolve as Ws}from"path";import{cwd as Fp}from"process";import js from"semver";var qs,Ip,Dp,Op,Bs,Rs,Np,Us,Vs,un=d(()=>{qs=U(B(),1);lt();V();Ip=["react","svelte","vue","vanilla"],Dp=[".tsx",".svelte",".vue",".jsx"],Op=new Set(Dp),Bs=t=>Op.has(t),Rs="No supported UI library found.  You can file an RFC for a new UI Library here: https://github.com/PlasmoHQ/plasmo/issues",Np=async t=>{if(t.includes(":")){let[e,r]=t.split(":");switch(e){case"file":default:let n=await(0,qs.readJson)(Ws(Fp(),r,"package.json"));return js.coerce(n.version)?.major}}else return js.coerce(t)?.major},Us=async t=>{let e=t.dependencies??{},r=Ip.find(s=>s in e);if(r===void 0)return{name:"vanilla",path:"vanilla",version:8427};let n=await Np(e[r]);if(n===void 0)throw new Error(Rs);if(r==="react"&&n<18)return{name:r,path:"react17",version:n};let o=`${r}${n}`,i=Ws(t.templatePath.staticTemplatePath,o);if(!await $(i))throw new Error(Rs);return{name:r,path:o,version:n}},Vs=t=>{switch(t){case"svelte":return{uiExts:[".svelte"],mountExt:".ts"};case"vue":return{uiExts:[".vue"],mountExt:".ts"};case"react":return{uiExts:[".tsx",".jsx"],mountExt:".tsx"};case"vanilla":return{uiExts:[".tsx",".jsx"],mountExt:".ts"};default:Je(t)}}});import{readFile as Hs,writeFile as $p}from"fs/promises";import{join as mn,relative as Tp,resolve as me}from"path";var Ke,or,Js=d(()=>{Ke=U(B(),1);dt();V();b();Ge();Yr();un();or=class{constructor(e){this.plasmoManifest=e}#o={};#i={};get projectPath(){return this.plasmoManifest.projectPath}get commonPath(){return this.plasmoManifest.commonPath}get mountExt(){return this.plasmoManifest.mountExt}async init(){let[e,...r]=await Promise.all([this.#r(),this.#n("popup"),this.#n("options"),this.#n("newtab"),this.#n("devtools")]);return r}#r=async()=>{let e=me(this.plasmoManifest.templatePath.staticTemplatePath,"common"),r=me(this.commonPath.staticDirectory,"common");return(0,Ke.copy)(e,r)};#n=async e=>{m(`Creating static templates for ${e}`);let r=this.projectPath[`${e}IndexList`],n=this.projectPath[`${e}HtmlList`],[o,i]=await Promise.all([r,n].map(c=>ge(c,$))),{staticDirectory:s}=this.commonPath;await(0,Ke.ensureDir)(s);let a=o!==void 0,u=a?Z(Tp(s,o)):`~${e}`,h=me(s,`${e}${this.mountExt}`);return await Promise.all([this.#e(`index${this.mountExt}`,h,{__plasmo_import_module__:u}),this.createPageHtml(e,i)]),a};generateHtml=async(e="",r="",n="")=>{let o={__plasmo_static_index_title__:this.plasmoManifest.name,__plasmo_static_script__:r};return await kt(n)?this.#t(n,e,{...o,"</body>":`<div id="__plasmo"></div><script src="${r}" type="module"></script></body>`}):this.#e("index.html",e,o)};createPageHtml=async(e,r="")=>{let n=me(this.commonPath.dotPlasmoDirectory,`${e}.html`),o=`./static/${e}${this.mountExt}`;return this.generateHtml(n,o,r)};createPageMount=async e=>{m(`Creating page mount template for ${e.dir}`);let r=me(this.commonPath.dotPlasmoDirectory,e.dir),n=me(r,`${e.name}.html`);await(0,Ke.ensureDir)(r);let o=Bs(e.ext),i=me(r,`${e.name}${this.mountExt}`),s=me(this.commonPath.sourceDirectory,e.dir,`${e.name}.html`),a=await Promise.all(o?[this.#e(`index${this.mountExt}`,i,{__plasmo_import_module__:`~${Z(mn(e.dir,e.name))}`}),this.generateHtml(n,`./${e.name}${this.mountExt}`,s)]:[this.generateHtml(n,`~${Z(mn(e.dir,e.name))}${e.ext}`,s)]);return{htmlPath:n,wereFilesWritten:a.some(u=>u)}};createContentScriptMount=async e=>{m(`Creating content script mount for ${e.dir}`);let r=me(this.commonPath.staticDirectory,e.dir);await(0,Ke.ensureDir)(r);let n=me(r,`${e.name}${this.mountExt}`);return await this.#e(`content-script-ui-mount${this.mountExt}`,n,{__plasmo_mount_content_script__:`~${Z(mn(e.dir,e.name))}`}),n};#s=async(e,r,n)=>{let o=Object.entries(n).reduce((s,[a,u])=>s.replaceAll(a,u),e),i=zt(Buffer.from(o));return this.#i[r]===i?!1:(this.#i[r]=i,await $p(r,o),!0)};#t=async(e,r,n)=>{let o=await Hs(e,"utf8");return this.#s(o,r,n)};#e=async(e,r,n)=>(this.#o[e]||=await Hs(me(this.plasmoManifest.staticScaffoldPath,e),"utf8"),this.#s(this.#o[e],r,n))}});import{ok as ye}from"assert";import Ap from"fast-glob";import{readdir as jp}from"fs/promises";import Rp from"node-object-hash";import{basename as qp,dirname as Wp,extname as Gs,isAbsolute as Bp,join as Up,parse as zs,relative as ir,resolve as Ye}from"path";import{cwd as Vp}from"process";var ee,vt,Hp,Jp,Qe,pn=d(()=>{ee=U(B(),1);lt();hr();V();b();Ge();rn();an();Ct();Ms();en();nn();Wr();Ds();cn();Ts();As();Js();un();vt={16:"./gen-assets/icon16.plasmo.png",32:"./gen-assets/icon32.plasmo.png",48:"./gen-assets/icon48.plasmo.png",64:"./gen-assets/icon64.plasmo.png",128:"./gen-assets/icon128.plasmo.png"},Hp=["storage"],Jp=Rp({trim:!0,sort:!0}),Qe=class{constructor(e){this.bundleConfig=e;this.data.icons=vt,this.scaffolder=new or(this)}get browser(){return this.bundleConfig.browser}#o;get commonPath(){return Ur(this.#o)}#i;get projectPath(){return Ur(this.#i)}templatePath=Wt();#r;get combinedEnv(){return ye(this.#r),this.#r.combinedEnv}get publicEnv(){return ye(this.#r),this.#r.plasmoPublicEnv}#n=new Set([".ts",".js"]);#s=new Set;#t;get uiLibrary(){return ye(this.#t),this.#t.uiLibrary}get mountExt(){return ye(this.#t),this.#t.uiExtMap.mountExt}get uiExts(){return ye(this.#t),this.#t.uiExtMap.uiExts}#e="";#a="";data={};overideManifest={};packageData;contentScriptMap=new Map;get mainWorldScriptList(){let e=[];for(let r of this.contentScriptMap.values())r.world==="MAIN"&&e.push(r);return e}get hasMainWorldScript(){for(let e of this.contentScriptMap.values())if(e.world==="MAIN")return!0;return!1}copyMap=new Map;permissionSet=new Set;scaffolder;get changed(){return this.#e!==this.#a}get name(){return ye(this.packageData),this.packageData.displayName}get dependencies(){return ye(this.packageData),this.packageData.dependencies}get devDependencies(){return ye(this.packageData),this.packageData.devDependencies}get staticScaffoldPath(){return ye(this.uiLibrary),Ye(this.templatePath.staticTemplatePath,this.uiLibrary.path)}async initEnv(e=Vp()){this.#r=await Ps(e),this.#o=je(e)}async startup(){await this.initEnv(),m(`Ensure exists: ${this.commonPath.dotPlasmoDirectory}`),await(0,ee.ensureDir)(this.commonPath.dotPlasmoDirectory),await Os(this.commonPath),await $s(this.commonPath),await Yt(this.commonPath),await Is(this.commonPath),await this.updateEnv(),await this.updatePackageData()}async postBuild(){await Promise.all(Array.from(this.copyMap,async([e,r])=>{await _t(e)||await(0,ee.copy)(r,e)}))}async updateEnv(){await this.initEnv(this.commonPath.projectDirectory),await _s(this)}prefixDev=(e="")=>process.env.NODE_ENV==="development"?`DEV | ${e}`:e;async updatePackageData(){if(this.packageData=await(0,ee.readJson)(this.commonPath.packageFilePath),!this.packageData)throw new Error("Invalid package.json");this.data.version=this.packageData.version,this.data.author=this.packageData.author,this.data.name=this.prefixDev(this.packageData.displayName),this.data.description=this.packageData.description,this.packageData.homepage&&(this.data.homepage_url=this.packageData.homepage);for(let e of Hp)`@plasmohq/${e}`in(this.packageData.dependencies||{})&&this.permissionSet.add(e);await this.#c(),this.overideManifest=await this.#u()}#c=async()=>{let e=await Us(this),r=Vs(e.name);this.#t={uiLibrary:e,uiExtMap:r},this.#s=new Set(r.uiExts),this.uiExts.forEach(n=>{this.#n.add(n)}),this.#i=xs(this.commonPath,this.browser,this.uiExts)};toggleOptions=(e=!1)=>(e?this.data.options_ui={page:"./options.html",open_in_tab:!0}:delete this.data.options_ui,this);toggleOverrides=(e,r=!1)=>(r?this.data.chrome_url_overrides={...this.data.chrome_url_overrides,[e]:`./${e}.html`}:delete this.data.chrome_url_overrides?.[e],this);toggleNewtab=(e=!1)=>this.toggleOverrides("newtab",e);toggleDevtools=(e=!1)=>(e?this.data.devtools_page="./devtools.html":delete this.data.devtools_page,this);isPathInvalid=e=>{if(e===void 0)return!0;let r=Gs(e);if(!this.#n.has(r))return!0;let n=es(e);return!!(n.length>0&&n!==`.${this.browser}`||n.length===0&&(0,ee.existsSync)(e.replace(r,`.${this.browser}${r}`)))};toggleContentScript=async(e,r=!1)=>{if(this.isPathInvalid(e))return!1;if(r){let n=await Cs(e);m("Adding content script: ",e);let o=ir(this.commonPath.dotPlasmoDirectory,e),i=Gs(o),s=this.#s.has(i);if(this.uiLibrary?.name!=="vanilla"&&s){let u=Up("lab",o).replace(/(^src)[\\/]/,""),h=zs(u);o=ir(this.commonPath.dotPlasmoDirectory,await this.scaffolder.createContentScriptMount(h))}n?.config?.css&&n.config.css.length>0&&(n.config.css=n.config.css.map(u=>ir(this.commonPath.dotPlasmoDirectory,Ye(Wp(e),u))));let a=this.injectEnvToObj({matches:["<all_urls>"],js:[n?.config?.world==="MAIN"?o.split(i)[0]:o],...n?.config||{}});this.contentScriptMap.set(e,a)}else this.contentScriptMap.delete(e);return r};addDirectory=async(e,r)=>(0,ee.existsSync)(e)?jp(e,{withFileTypes:!0}).then(n=>Promise.all(n.filter(o=>o.isFile()).map(o=>Ye(e,o.name)).map(o=>r(o,!0)))).then(n=>n.includes(!0)):!1;addContentScriptsDirectory=async(e=this.projectPath.contentsDirectory)=>this.addDirectory(e,this.toggleContentScript);togglePage=async(e,r=!1)=>{if(this.isPathInvalid(e))return!1;if(r){let n=ir(this.commonPath.sourceDirectory,e),o=zs(n),{wereFilesWritten:i}=await this.scaffolder.createPageMount(o);i&&(this.#e="")}else this.#e="";return r};addPagesDirectory=async e=>this.addDirectory(e,this.togglePage);write=(e=!1)=>{this.#a=this.#e;let r=this.toJSON();if(this.#e=Jp.hash(r),!(!this.changed&&!e))return m("Hash changed, updating manifest"),(0,ee.writeJson)(this.commonPath.entryManifestPath,r,{spaces:2})};toJSON=()=>{let e={...this.data},{options_ui:r,permissions:n,content_scripts:o,background:i,...s}=this.overideManifest;return this.bundleConfig.manifestVersion==="mv2"&&(e.background={...e.background,...i},Object.keys(e.background).length===0&&delete e.background),e.options_ui?.page&&(e.options_ui={...e.options_ui,...r}),e.permissions=[...new Set([...this.permissionSet,...n||[]])],e.permissions?.length===0&&delete e.permissions,e.content_scripts=[...Array.from(this.contentScriptMap.values()).filter(a=>a.world!=="MAIN"),...o||[]],e.content_scripts.length===0&&delete e.content_scripts,{...e,...s}};#u=async()=>{if(!this.packageData?.manifest)return{};let e=await this.prepareOverrideManifest();if((e.web_accessible_resources?.length||0)>0&&(e.web_accessible_resources=await this.resolveWAR(this.packageData.manifest.web_accessible_resources)),e.browser_specific_settings)switch(this.browser){case"edge":case"safari":e.browser_specific_settings={[this.browser]:e.browser_specific_settings[this.browser]};break;case"firefox":case"gecko":e.browser_specific_settings={gecko:e.browser_specific_settings.gecko};break;default:delete e.browser_specific_settings}return this.injectEnvToObj(e)};copyProjectFile=async e=>{try{if(e.startsWith("~"))return this.copyProjectFile(e.slice(1));if(e.includes("*")){let i=await Ap(e,{cwd:this.commonPath.projectDirectory,onlyFiles:!0});return await Promise.all(i.map(this.copyProjectFile)),e}let r=Bp(e)?e:Ye(this.commonPath.projectDirectory,e);if(!(!this.projectPath.isEntryPath(r)&&await(0,ee.pathExists)(r)))return e;let o=Ye(this.commonPath.distDirectory,e);return this.copyMap.set(o,r),Z(e)}catch{return e}};copyNodeModuleFile=async e=>{try{let r=C.resolve(e,{paths:[this.commonPath.projectDirectory]}),n=qp(r),o=Ye(this.commonPath.distDirectory,n);return this.copyMap.set(o,r),n}catch{return null}};injectEnvToObj=e=>nr(e,r=>typeof r!="string"?r:r.match(/^\$(\w+)$/)?this.combinedEnv[r.substring(1)]||void 0:gn(r,this.combinedEnv))}});var sr,Ks=d(()=>{pn();sr=class extends Qe{constructor(e){super(e),this.data.manifest_version=2,this.data.browser_action={default_icon:vt}}togglePopup=(e=!1)=>(e?this.data.browser_action.default_popup="./popup.html":delete this.data.browser_action.default_popup,this);toggleBackground=(e=!1)=>(e?this.data.background={scripts:["./static/background/index.ts"]}:delete this.data.background,e);prepareOverrideManifest=()=>{let{manifest:e}=this.packageData,r={...e};return r.permissions=[...e.permissions||[],...e.host_permissions||[]],"host_permissions"in r&&delete r.host_permissions,"content_security_policy"in e&&(r.content_security_policy=e.content_security_policy?.extension_pages),r};resolveWAR=e=>Promise.all(e.map(async({resources:r})=>(await Promise.all(r.map(async o=>await this.copyNodeModuleFile(o)||await this.copyProjectFile(o)))).flat())).then(r=>r.flat())}});var ar,Ys=d(()=>{pn();ar=class extends Qe{constructor(e){super(e),this.data.manifest_version=3,this.data.action={default_icon:vt}}togglePopup=(e=!1)=>(e?this.data.action.default_popup="./popup.html":delete this.data.action.default_popup,this);toggleBackground=(e=!1)=>(e?this.data.background={service_worker:"./static/background/index.ts"}:delete this.data.background,e);prepareOverrideManifest=()=>({...this.packageData.manifest});resolveWAR=e=>Promise.all(e.map(async({resources:r,...n})=>({resources:(await Promise.all(r.map(async i=>await this.copyNodeModuleFile(i)||await this.copyProjectFile(i)))).flat(),...n})))}});async function Xe(t){m("Creating Manifest Factory...");let e=t.manifestVersion==="mv3"?new ar(t):new sr(t);await e.startup();let{contentIndexList:r,sandboxIndexList:n,tabsDirectory:o,sandboxesDirectory:i}=e.projectPath,[s,a]=await Promise.all([r,n].map(g=>ge(g,$))),u=await Promise.all([e.scaffolder.init(),e.togglePage(a,!0),e.toggleContentScript(s,!0),e.addContentScriptsDirectory(),e.addPagesDirectory(o),e.addPagesDirectory(i)]);u.push(await ht(e));let h=u.flat();h.includes(!0)||te("Unable to find any entry files. The extension might be empty");let[c,p,f,l]=h;return e.togglePopup(c).toggleOptions(p).toggleNewtab(f).toggleDevtools(l),await e.write(!0),e}var cr=d(()=>{dt();V();b();Qr();Ks();Ys()});var Qs={};Ie(Qs,{default:()=>zp});async function Gp(){re(),process.env.NODE_ENV="development";let t=Q("--serve-port")||"1012",e=Q("--hmr-port")||"1815";M("Starting the extension development server...");let r=He(),n=await Xe(r),o=await Ss(n),{default:i}=await import("get-port"),[s,a]=await Promise.all([i({port:parseInt(t)}),i({port:parseInt(e)})]);m(`Starting dev server on ${s}, HMR on ${a}...`);let u=await Xt(n,{logLevel:"verbose",shouldBundleIncrementally:!0,serveOptions:{host:"localhost",port:s},hmrOptions:{host:"localhost",port:a}}),{default:h}=await import("chalk"),c=await Bi(a),p=await u.watch(async(l,g)=>{if(l)throw l;g!==void 0&&(g.type==="buildSuccess"?(ve(`Extension re-packaged in ${h.bold(g.buildTime)}ms! \u{1F680}`),await n.postBuild(),c.triggerReload()):g.type==="buildFailure"&&(rt()||de(h.redBright(`Build failed. To debug, run ${h.bold("plasmo dev --verbose")}.`)),g.diagnostics.forEach(P=>{de(h.redBright(P.message)),P.stack&&m(P.stack),P.hints?.forEach(w=>{m(w)}),P.codeFrames?.forEach(w=>{w.code&&m(w.code),w.codeHighlights.forEach(x=>{x.message&&m(x.message),m(h.underline(`${w.filePath}:${x.start.line}:${x.start.column}`))})})})),process.env.__PLASMO_FRAMEWORK_INTERNAL_WATCHER_STARTED="true")}),f=()=>{o?.unsubscribe(),p.unsubscribe()};process.on("SIGINT",f),process.on("SIGTERM",f)}var zp,Xs=d(()=>{pe();b();Ui();Vt();Es();on();De();cr();zp=Gp});import{readFile as Kp,readdir as Yp,rename as Zs,stat as Qp,writeFile as Xp}from"fs/promises";import{join as Zp,resolve as el}from"path";var tl,ln,ea=d(()=>{tl=async t=>{let r=(await Kp(el(t),"utf8")).replace(/\/_/g,"/");await Xp(t,r,"utf8")},ln=async(t="")=>{let e=await Yp(t);for(let r of e){let n=Zp(t,r);if((await Qp(n)).isDirectory()){let i=n.replace("/_","/");await Zs(n,i),await ln(i)}else{let i=n.replace("/_","/");await Zs(n,i),await tl(i)}}}});import{sentenceCase as rl}from"change-case";import{mkdir as nl}from"fs/promises";import{resolve as fn}from"path";var Fe,ol,ta,ra=d(()=>{Fe=U(B(),1);V();b();Ct();ea();ol=t=>({name:rl(t.name),description:t.description,version:t.version,manifest_version:3,chrome_url_overrides:{newtab:"./index.html"}}),ta=async()=>{let{projectDirectory:t,packageFilePath:e}=je();m("Creating a Plasmo + Nextjs based new tab extension");let r=fn(t,"out"),{default:n}=await import("chalk");if(!await $(r))throw new Error(`${n.bold("out")} directory does not exist, did you forget to run "${n.underline("next build && next export")}"?`);let o=await(0,Fe.readJson)(e),i=fn(t,"extension");if(await $(i)){let{default:{prompt:s}}=await import("inquirer"),{answer:a}=await s({type:"confirm",name:"answer",message:`${n.bold("extension")} directory already exists, do you want to overwrite it?`});if(!a)throw new Error("Aborted");await(0,Fe.emptyDir)(i)}await nl(i),await(0,Fe.copy)(r,i),m("Extension created at:",i),await ln(i),await(0,Fe.writeJson)(fn(i,"manifest.json"),ol(o),{spaces:2}),ve("Your extension is ready in the extension/ directory")}});import{createWriteStream as il}from"fs";import{resolve as sl}from"path";var ur,dn=d(()=>{b();ur=async({distDirectory:t,buildDirectory:e,distDirectoryName:r})=>{let{default:n}=await import("archiver"),o=n("zip",{zlib:{level:9}}),i=sl(e,`${r}.zip`),s=il(i);s.on("close",()=>{M(`Zip Package size: ${o.pointer()} bytes`)}),o.pipe(s),o.directory(t,""),await o.finalize()}});var na={};Ie(na,{default:()=>cl});async function al(){re(),process.env.NODE_ENV="production";let[t]=xt("build");if(t==="next-new-tab"){await ta();return}M("Prepare to bundle the extension...");let e=He(),r=await Xe(e),o=await(await Xt(r,{mode:"production",shouldDisableCache:!0,shouldContentHash:!1,defaultTargetOptions:{shouldOptimize:!q("--no-minify"),shouldScopeHoist:!q("--no-hoist")}})).run();ve(`Finished in ${o.buildTime}ms!`),await r.postBuild(),q("--zip")&&await ur(r.commonPath)}var cl,oa=d(()=>{St();pe();b();Vt();ra();on();De();cr();dn();cl=al});var ia={};Ie(ia,{default:()=>ml});async function ul(){re(),process.env.NODE_ENV="production",M("Prepare to package the extension bundle...");let t=He(),e=await Xe(t);await ur(e.commonPath)}var ml,sa=d(()=>{b();Vt();De();cr();dn();ml=ul});var mr={};Ie(mr,{default:()=>ll});async function pl(){console.log("0.67.4")}var ll,pr=d(()=>{ll=pl});var lr,gr,aa,yr=d(()=>{lr={help:()=>Promise.resolve().then(()=>(Sn(),xn)),start:()=>Promise.resolve().then(()=>(bn(),En)),init:()=>Promise.resolve().then(()=>(Wi(),qi)),dev:()=>Promise.resolve().then(()=>(Xs(),Qs)),build:()=>Promise.resolve().then(()=>(oa(),na)),package:()=>Promise.resolve().then(()=>(sa(),ia)),version:()=>Promise.resolve().then(()=>(pr(),mr)),["-v"]:()=>Promise.resolve().then(()=>(pr(),mr)),["--version"]:()=>Promise.resolve().then(()=>(pr(),mr))},gr=Object.keys(lr),aa=new Set(gr)});import{argv as ca,exit as hn,versions as fl}from"process";import dl from"semver";pe();b();b();import{stdout as wn}from"process";var va=t=>new Promise(e=>setTimeout(e,t));async function vn(t){for(let e=t;e>0;e--)wn.write(`${"\u{1F534} EXIT".padEnd(9)} | This program will terminate in ${e} seconds...\r`),await va(1e3);wn?.clearLine(0),fe("\u{1F534} EXIT","\u{1F44B} Good bye and have a great day!")}yr();De();async function hl(){re(),Et()}async function gl(){try{if(ca.length>10)throw new Error("Too many arguments provided.");if(dl.major(fl.node)<16)throw new Error("Node version must be >= 16");process.env.VERBOSE=yn?"true":"false";let t=ca.find(e=>aa.has(e));if(t in lr){m("Running command:",t);let{default:e}=await lr[t]();await e()}else m("Running default mode"),await hl()}catch(t){de(t.message||"Unknown error."),m(t.stack),await vn(3),hn(1)}}gl();process.on("SIGINT",()=>hn(0));process.on("SIGTERM",()=>hn(0));
