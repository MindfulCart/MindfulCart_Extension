var we=Object.create;var k=Object.defineProperty;var Pe=Object.getOwnPropertyDescriptor;var ke=Object.getOwnPropertyNames;var De=Object.getPrototypeOf,je=Object.prototype.hasOwnProperty;var Me=(e,o)=>{for(var s in o)k(e,s,{get:o[s],enumerable:!0})},F=(e,o,s,r)=>{if(o&&typeof o=="object"||typeof o=="function")for(let a of ke(o))!je.call(e,a)&&a!==s&&k(e,a,{get:()=>o[a],enumerable:!(r=Pe(o,a))||r.enumerable});return e};var R=(e,o,s)=>(s=e!=null?we(De(e)):{},F(o||!e||!e.__esModule?k(s,"default",{value:e,enumerable:!0}):s,e)),Le=e=>F(k({},"__esModule",{value:!0}),e);var Be={};Me(Be,{default:()=>Fe});module.exports=Le(Be);var ye=require("@mischnic/json-sourcemap"),xe=require("@parcel/plugin"),ve=require("@parcel/utils");var O=typeof globalThis.process<"u"?globalThis.process.argv:[];var N=()=>typeof globalThis.process<"u"?globalThis.process.env:{},Ee=/\$([\w+]+)/gm,B=(e,o=N(),s=Ee)=>e.replace(s,(r,a)=>o[a]||r);var Re=new Set(O),U=e=>Re.has(e),Je=O.filter(e=>e.startsWith("--")&&e.includes("=")).map(e=>e.split("=")).reduce((e,[o,s])=>(e[o]=s,e),{});var ze=U("--dry-run"),V=()=>U("--verbose")||N().VERBOSE==="true",Xe=V();var I=(e="",...o)=>console.log(e.padEnd(9),"|",...o);var D=(...e)=>I("\u{1F7E0} WARN",...e),Oe=0,b=(...e)=>V()&&I(`\u{1F7E1} ${Oe++}`,...e);var H=require("@parcel/diagnostic");var v=require("path"),Ne=(e,o,s,r)=>{let a={extraAssets:[],program:o,hmrOptions:r.hmrOptions,hot:!!r.hmrOptions,fs:e.fs,filePath:e.filePath,ptrs:s,asset:e,env:r.env,_isMV2:o.manifest_version===2},i=(0,v.dirname)(e.filePath),c=(0,v.resolve)(i,".."),n=(0,v.resolve)(c,"assets");return{...a,srcDir:process.env.PLASMO_SRC_DIR,dotPlasmoDir:i,projectDir:c,assetsDir:n,getAssets:()=>[...a.extraAssets,e]}},A={},l=()=>A,C=async(...e)=>{A=Ne(...e)},j=e=>A._isMV2;async function W(){let{program:e,filePath:o,ptrs:s,asset:r}=l(),a=j(e),i=a?"browser_action":"action",c=a?e.browser_action:e.action;c&&c.theme_icons&&(c.theme_icons=c.theme_icons.map((n,d)=>{for(let f of["light","dark"]){let u=(0,H.getJSONSourceLocation)(s[`/${i}/theme_icons/${d}/${f}`],"value");n[f]=r.addURLDependency(n[f],{loc:{...u,filePath:o}})}return n}))}var $=require("@parcel/diagnostic");var z=R(require("content-security-policy-parser")),J="'unsafe-eval'";function M(e,o=J){let s=o===J?"'self' blob: filesystem:":"'self'";if(e){let r=(0,z.default)(e);e="",r["script-src"]||(r["script-src"]=[s]),r["script-src"].includes(o)||r["script-src"].push(o),r.sandbox&&!r.sandbox.includes("allow-scripts")&&r.sandbox.push("allow-scripts");for(let a in r)e+=`${a} ${r[a].join(" ")};`;return e}else return`script-src ${s} ${o};object-src ${s};`}var X=()=>{let{program:e}=l();j(e)?G(e):Ve(e)},K="../runtime/plasmo-default-background.ts";function G(e){let{hot:o,asset:s,filePath:r,ptrs:a}=l();b("Handling background scripts"),e.background?.page&&(e.background.page=s.addURLDependency(e.background.page,{bundleBehavior:"isolated",loc:{filePath:r,...(0,$.getJSONSourceLocation)(a["/background/page"],"value")}})),e.background?.scripts&&(e.background.scripts=e.background.scripts.map(i=>s.addURLDependency(i,{bundleBehavior:"isolated"}))),o&&(e.content_security_policy=M(e.content_security_policy),e.background||(e.background={}),e.background?.scripts||(e.background.scripts=[]),e.background.scripts.push(s.addURLDependency(K,{resolveFrom:__filename})))}function Ve(e){let{hot:o,asset:s,filePath:r,ptrs:a,hmrOptions:i,env:c}=l();if(b("Handling background service worker"),e.background?.service_worker){if(c.PLASMO_BROWSER==="firefox"){let n=e;n.background.scripts=[e.background.service_worker],delete e.background.service_worker,G(n);return}e.background.service_worker=s.addURLDependency(e.background.service_worker,{bundleBehavior:"isolated",loc:{filePath:r,...(0,$.getJSONSourceLocation)(a["/background/service_worker"],"value")},env:{context:"service-worker"}}),e.background.type&&delete e.background.type}if(o){let n=e.content_security_policy||{};n.extension_pages=M(n.extension_pages,`http://${i?.host||"localhost"}`),n.sandbox&&(n.sandbox=M(n.sandbox)),e.content_security_policy=n,e.background||(e.background={service_worker:s.addURLDependency(K,{resolveFrom:__filename,env:{context:"service-worker"}})})}}var Q=require("@parcel/diagnostic");function Y(){let{program:e,asset:o,filePath:s,ptrs:r}=l();if(e.content_scripts)for(let a=0;a<e.content_scripts.length;++a){let i=e.content_scripts[a];for(let c of["css","js"]){let n=i[c]||[];for(let d=0;d<n.length;++d)n[d]=o.addURLDependency(n[d],{bundleBehavior:"isolated",loc:{filePath:s,...(0,Q.getJSONSourceLocation)(r[`/content_scripts/${a}/${c}/${d}`],"value")}})}}}var Z=require("@parcel/diagnostic");async function ee(){let{program:e,filePath:o,ptrs:s,asset:r}=l();if(!e.declarative_net_request)return;let a=e.declarative_net_request.rule_resources;a&&(e.declarative_net_request.rule_resources=a.map((i,c)=>(i.path=r.addURLDependency(i.path,{pipeline:"raw-env",loc:{filePath:o,...(0,Z.getJSONSourceLocation)(s[`/declarative_net_request/rule_resources/${c}/path`],"value")}}),i)))}var T=require("@parcel/diagnostic"),q=require("path");var Ae=[["icons"],["browser_action","default_icon"],["browser_action","default_popup"],["page_action","default_icon"],["page_action","default_popup"],["action","default_icon"],["action","default_popup"],["chrome_url_overrides"],["devtools_page"],["options_ui","page"],["sidebar_action","default_icon"],["sidebar_action","default_panel"],["storage","managed_schema"],["theme","images","theme_frame"],["theme","images","additional_backgrounds"],["user_scripts","api_script"]],te=()=>{let{program:e,filePath:o,ptrs:s,asset:r}=l(),a=Ae.map(i=>[i,"/"+i.join("/")]).filter(([i,c])=>!!s[c]);for(let[i,c]of a){let n=i.length-1,d=i[n],f=i.reduce((_,h,g)=>g===n?_:_[h],e),u=f[d];if(b(`Adding ${d}`),typeof u=="string"){let _=(0,q.extname)(u);f[d]=r.addURLDependency(u,{bundleBehavior:"isolated",loc:{filePath:o,...(0,T.getJSONSourceLocation)(s[c],"value")},needsStableName:_===".html",pipeline:_===".json"?"raw-env":void 0})}else for(let _ of Object.keys(u)){let h=(0,q.extname)(u[_]);u[_]=r.addURLDependency(u[_],{bundleBehavior:"isolated",loc:{filePath:o,...(0,T.getJSONSourceLocation)(s[c+"/"+_],"value")},needsStableName:h===".html",pipeline:h===".json"?"raw-env":void 0})}}};var L=R(require("@parcel/diagnostic")),oe=R(require("path"));function se(){let{program:e,ptrs:o,filePath:s,asset:r}=l();if(e.dictionaries)for(let a in e.dictionaries){let i=(0,L.getJSONSourceLocation)(o[`/dictionaries/${a}`],"value"),c={filePath:s,...i},n=e.dictionaries[a];if(oe.default.extname(n)!==".dic")throw new L.default({diagnostic:[{message:"Invalid Web Extension manifest",origin:"@plasmohq/parcel-transformer-manifest",codeFrames:[{filePath:s,codeHighlights:[{...i,message:"Dictionaries must be .dic files"}]}]}]});e.dictionaries[a]=r.addURLDependency(n,{needsStableName:!0,loc:c}),r.addURLDependency(n.slice(0,-4)+".aff",{needsStableName:!0,loc:c})}}var y=require("path");var re=async(e,o,s="json",r=[])=>{let{asset:a,fs:i,extraAssets:c}=l(),n=await i.readFile(e,"utf8"),d=B(n);c.push({type:s,uniqueKey:o,content:d,bundleBehavior:"isolated",isBundleSplittable:s!=="json",env:a.env,dependencies:r,meta:{bundlePath:o,webextEntry:!1}})},ae=e=>{process.env.__PLASMO_FRAMEWORK_INTERNAL_WATCHER_STARTED||D(e)};async function ie(){let{program:e,asset:o,assetsDir:s,projectDir:r}=l(),a=[(0,y.resolve)(r,"locales"),(0,y.resolve)(s,"locales"),(0,y.resolve)(s,"_locales")].find(n=>o.fs.existsSync(n));if(!a)return;let i=await o.fs.readdir(a);if(i.length===0){b("No locale found, skipping");return}if(e.default_locale||(e.default_locale=i[0],ae(`default_locale not set, fallback to ${i[0]}`)),!await o.fs.exists((0,y.resolve)(a,e.default_locale,"messages.json"))){D("Default locale message.json not found, skipping locale!"),delete e.default_locale;return}await Promise.all(i.map(async n=>{b(`Adding locale ${n}`);let d=(0,y.resolve)(a,n,"messages.json");if(await o.fs.exists(d)){let f=`_locales/${n}/messages.json`;o.invalidateOnFileChange(d),await re(d,f)}}))}var S=require("path");async function ne(){let{asset:e,srcDir:o,dotPlasmoDir:s,program:r}=l(),a=["sandboxes","sandbox.ts","sandbox.tsx"].map(g=>(0,S.resolve)(o,g)),i=(0,S.resolve)(s,"sandboxes"),[c,n,d,f]=await Promise.all([...a,i].map(g=>e.fs.exists(g))),[u]=a,_=[];if(c&&f){let g=await e.fs.readdir(u);g.length>0&&g.forEach(x=>{let P=x.split(".");P.pop(),_.push([x,`${P.join(".")}.html`])})}let h=n||d;!h&&_.length===0||(r.sandbox||(r.sandbox={}),r.sandbox.pages||(r.sandbox.pages=[]),h&&r.sandbox.pages.push(e.addURLDependency("sandbox.html",{needsStableName:!0})),await Promise.all(_.map(async([g,x])=>{let P=(0,S.resolve)(u,g),Se=(0,S.resolve)(i,x);await e.fs.exists(P)&&await e.fs.exists(Se)&&(b(`Adding sandbox page: ${g}`),r.sandbox.pages.push(e.addURLDependency(`sandboxes/${x}`,{needsStableName:!0})))})))}var w=require("path");async function ce(){let{asset:e,dotPlasmoDir:o,srcDir:s}=l(),r=(0,w.resolve)(s,"tabs"),a=(0,w.resolve)(o,"tabs"),[i,c]=await Promise.all([e.fs.exists(a),e.fs.exists(r)]);if(!i||!c)return;let n=await e.fs.readdir(r);if(n.length===0){b(`No tab found in ${r}, skipping`);return}let d=n.map(f=>{let u=f.split(".");return u.pop(),[f,`${u.join(".")}.html`]});await Promise.all(d.map(async([f,u])=>{let _=(0,w.resolve)(a,u),h=(0,w.resolve)(r,f);await e.fs.exists(_)&&await e.fs.exists(h)&&(b(`Adding tab ${f}`),e.addURLDependency(`./tabs/${u}`,{bundleBehavior:"isolated",needsStableName:!0}))}))}var pe=()=>{let{program:e}=l();delete e.$schema};var $e=e=>e.some(o=>{let s=Number(o);return!isNaN(s)&&s<0&&s>65536}),le=(e,o=3,s="Browser")=>{let r=e.split(".");if(r.length>o)return`${s} versions to have at most ${o} dots`;if($e(r))return`${s} versions must be dot-separated integers between 0 and 65535`},de=e=>le(e,3,"Semantic"),ue=e=>le(e,4,"Browser");var t={type:"string"},m={type:"boolean"},fe={type:"object",properties:{},additionalProperties:t},E={browser_style:m,chrome_style:m,default_icon:{oneOf:[fe,t]},default_popup:t,default_title:t},p={type:"array",items:t},_e={type:"object",properties:{...E,default_area:{type:"string",enum:["navbar","menupanel","tabstrip","personaltoolbar"]},theme_icons:{type:"array",items:{type:"object",properties:{light:t,dark:t,size:{type:"number"}},additionalProperties:!1,required:["light","dark","size"]}}},additionalProperties:!1},me={type:"object",properties:{resources:p,matches:p,extension_ids:p,use_dynamic_url:m},additionalProperties:!1},be={$schema:t,name:t,version:{type:"string",__validate:de},default_locale:t,description:t,icons:fe,author:t,browser_specific_settings:{type:"object",properties:{},additionalProperties:{type:"object",properties:{}}},chrome_settings_overrides:{type:"object",properties:{homepage:t,search_provider:{type:"object",properties:{name:t,keyword:t,favicon_url:t,search_url:t,encoding:t,suggest_url:t,image_url:t,instant_url:t,search_url_post_params:t,suggest_url_post_params:t,image_url_post_params:t,instant_url_post_params:t,alternate_urls:p,prepopulated_id:{type:"number"},is_default:m},additionalProperties:!1,required:["name","search_url"]},startup_pages:p},additionalProperties:!1},chrome_url_overrides:{type:"object",properties:{bookmarks:t,history:t,newtab:t},additionalProperties:!1},commands:{type:"object",properties:{},additionalProperties:{type:"object",properties:{suggested_key:{type:"object",properties:{default:t,mac:t,linux:t,windows:t,chromeos:t,android:t,ios:t},additionalProperties:!1},description:t},additionalProperties:!1}},content_scripts:{type:"array",items:{type:"object",properties:{matches:p,css:p,js:p,match_about_blank:m,exclude_matches:p,include_globs:p,exclude_globs:p,run_at:{type:"string",enum:["document_idle","document_start","document_end"]},all_frames:m},additionalProperties:!1,required:["matches"]}},declarative_net_request:{type:"object",properties:{rule_resources:{type:"array",items:{type:"object",properties:{id:t,enabled:m,path:t},additionalProperties:!1,required:["id","enabled","path"]}}},additionalProperties:!1,required:["rule_resources"]},devtools_page:t,dictionaries:{type:"object",properties:{},additionalProperties:t},externally_connectable:{type:"object",properties:{ids:p,matches:p,accept_tls_channel_id:m},additionalProperties:!1},file_browser_handlers:{type:"array",items:{type:"object",properties:{id:t,default_title:t,file_filters:p},additionalProperties:!1,required:["id","default_title","file_filters"]}},file_system_provider_capabilities:{type:"object",properties:{configurable:m,multiple_mounts:m,watchable:m,source:{type:"string",enum:["file","device","network"]}},additionalProperties:!1,required:["source"]},homepage_url:t,incognito:{type:"string",enum:["spanning","split","not_allowed"]},key:t,minimum_chrome_version:{type:"string",__validate:ue},oauth2:{type:"object",properties:{client_id:t,scopes:p},additionalProperties:!1},offline_enabled:m,omnibox:{type:"object",properties:{},additionalProperties:t},optional_host_permissions:p,optional_permissions:p,options_ui:{type:"object",properties:{browser_style:m,chrome_style:m,open_in_tab:m,page:t},additionalProperties:!1,required:["page"]},permissions:p,protocol_handlers:{type:"array",items:{type:"object",properties:{protocol:t,name:t,uriTemplate:t},additionalProperties:!1,required:["protocol","name","uriTemplate"]}},requirements:{type:"object",properties:{"3D":{type:"object",properties:{features:p},additionalProperties:!1}}},short_name:t,sidebar_action:{type:"object",properties:{browser_style:E.browser_style,default_icon:E.default_icon,default_panel:t,default_title:t,open_at_install:m},additionalProperties:!1,required:["default_panel"]},storage:{type:"object",properties:{managed_schema:t},additionalProperties:!1},theme:{type:"object",properties:{images:{type:"object",properties:{theme_frame:t,additional_backgrounds:p},additionalProperties:!1},colors:{type:"object",properties:{bookmark_text:t,button_background_active:t,button_background_hover:t,icons:t,icons_attention:t,frame:t,frame_inactive:t,ntp_background:t,ntp_text:t,popup:t,popup_border:t,popup_highlight:t,popup_highlight_text:t,popup_text:t,sidebar:t,sidebar_border:t,sidebar_highlight:t,sidebar_highlight_text:t,sidebar_text:t,tab_background_separator:t,tab_background_text:t,tab_line:t,tab_loading:t,tab_selected:t,tab_text:t,toolbar:t,toolbar_bottom_separator:t,toolbar_field:t,toolbar_field_border:t,toolbar_field_border_focus:t,toolbar_field_focus:t,toolbar_field_highlight:t,toolbar_field_highlight_text:t,toolbar_field_separator:t,toolbar_field_text:t,toolbar_field_text_focus:t,toolbar_text:t,toolbar_top_separator:t,toolbar_vertical_separator:t},additionalProperties:!1},properties:{type:"object",properties:{additional_backgrounds_alignment:p,additional_backgrounds_tiling:{type:"array",items:{type:"string",enum:["no-repeat","repeat","repeat-x","repeat-y"]}}},additionalProperties:!1}},additionalProperties:!1,required:["colors"]},tts_engine:{type:"object",properties:{voices:{type:"array",items:{type:"object",properties:{voice_name:t,lang:t,event_type:{type:"string",enum:["start","word","sentence","marker","end","error"]}},additionalProperties:!1,required:["voice_name","event_type"]}}},additionalProperties:!1},update_url:t,user_scripts:{type:"object",properties:{api_script:t},additionalProperties:!1},version_name:t},ge={type:"object",properties:{...be,manifest_version:{type:"number",enum:[3]},action:_e,background:{type:"object",properties:{service_worker:t,type:{type:"string",enum:["classic","module"]}},additionalProperties:!1,required:["service_worker"]},content_security_policy:{type:"object",properties:{extension_pages:t,sandbox:t},additionalProperties:!1},host_permissions:p,sandbox:{type:"object",properties:{pages:p},additionalProperties:!1},web_accessible_resources:{type:"array",items:{oneOf:[{...me,required:["resources","matches"]},{...me,required:["resources","extension_ids"]}]}}},required:["manifest_version","name","version"]},he={type:"object",properties:{...be,manifest_version:{type:"number",enum:[2]},background:{type:"object",properties:{scripts:p,page:t,persistent:m},additionalProperties:!1},browser_action:_e,content_security_policy:t,page_action:{type:"object",properties:{...E,hide_matches:p,show_matches:p,pinned:m},additionalProperties:!1},sandbox:{type:"object",properties:{pages:p,content_security_policy:t},additionalProperties:!1},web_accessible_resources:p},required:["manifest_version","name","version"]};async function Te(){pe(),await Promise.all([ce(),ne(),ie(),W(),ee()]),Y(),se(),te(),X()}var qe=()=>{switch(process.env.__PLASMO_FRAMEWORK_INTERNAL_SOURCE_MAPS){case"inline":return{inline:!0,inlineSources:!0};case"external":return{inline:!1,inlineSources:!1};default:return}},Fe=new xe.Transformer({async transform({asset:e,options:o}){b("@plasmohq/parcel-transformer-manifest"),e.setEnvironment({context:"browser",outputFormat:e.env.outputFormat==="commonjs"?"global":e.env.outputFormat,engines:{browsers:e.env.engines.browsers},sourceMap:e.env.sourceMap&&qe(),includeNodeModules:e.env.includeNodeModules,sourceType:e.env.sourceType,isLibrary:e.env.isLibrary,shouldOptimize:e.env.shouldOptimize,shouldScopeHoist:e.env.shouldScopeHoist});let s=await e.getCode(),r=(0,ye.parse)(s),a=r.data,i=a.manifest_version===3?ge:he;ve.validateSchema.diagnostic(i,{data:a,source:s,filePath:e.filePath},"@plasmohq/parcel-transformer-manifest","Invalid Web Extension manifest"),await C(e,a,r.pointers,o);let c=l();return await Te(),c.asset.setCode(JSON.stringify(a,null,2)),c.asset.meta.webextEntry=!0,c.getAssets()}});0&&(module.exports={});
